<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 6.4.4" />
    <title>esbmtk.processes API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>


<style type="text/css">/*! * Bootstrap Reboot v5.0.0-beta1 (https://getbootstrap.com/) * Copyright 2011-2020 The Bootstrap Authors * Copyright 2011-2020 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}[tabindex="-1"]:focus:not(:focus-visible){outline:0!important}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus{outline:dotted 1px;outline:-webkit-focus-ring-color auto 5px}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style type="text/css">/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style type="text/css">/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main{padding:2rem 3vw;}.git-button{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{display:none;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3, .pdoc h4{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{--shift:-40px;text-align:right;margin-top:var(--shift);margin-bottom:calc(0px - var(--shift));clear:both;filter:opacity(1);}.pdoc details:not([open]){height:0;overflow:visible;}.pdoc details > summary{font-size:.75rem;cursor:pointer;color:var(--muted);border-width:0;padding:0 .7em;display:inline-block;display:inline list-item;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc details > div{margin-top:calc(0px - var(--shift) / 2);text-align:left;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:3rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{color:var(--text);margin:1rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox">
            <div>
                        <a class="pdoc-button module-list-button" href="../esbmtk.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                            &nbsp;esbmtk</a>




                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="class" href="#Process">Process</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Process.__init__">Process</a>
                        </li>
                        <li>
                                <a class="function" href="#Process.show_figure">show_figure</a>
                        </li>
                        <li>
                                <a class="variable" href="#Process.direction">direction</a>
                        </li>
                        <li>
                                <a class="variable" href="#Process.flux">flux</a>
                        </li>
                        <li>
                                <a class="variable" href="#Process.mo">mo</a>
                        </li>
                        <li>
                                <a class="variable" href="#Process.r">r</a>
                        </li>
                        <li>
                                <a class="variable" href="#Process.reservoir">reservoir</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GenericFunction">GenericFunction</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GenericFunction.__init__">GenericFunction</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.lkk">lkk</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.lrk">lrk</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.lod">lod</a>
                        </li>
                        <li>
                                <a class="function" href="#GenericFunction.get_process_args">get_process_args</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.a1">a1</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.a2">a2</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.a3">a3</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.a4">a4</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.act_on">act_on</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.function">function</a>
                        </li>
                        <li>
                                <a class="variable" href="#GenericFunction.i">i</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LookupTable">LookupTable</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#AddSignal">AddSignal</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AddSignal.__init__">AddSignal</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PassiveFlux">PassiveFlux</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PassiveFlux.__init__">PassiveFlux</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PassiveFlux_fixed_delta">PassiveFlux_fixed_delta</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PassiveFlux_fixed_delta.__init__">PassiveFlux_fixed_delta</a>
                        </li>
                        <li>
                                <a class="variable" href="#PassiveFlux_fixed_delta.f">f</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#VarDeltaOut">VarDeltaOut</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#VarDeltaOut.__init__">VarDeltaOut</a>
                        </li>
                        <li>
                                <a class="variable" href="#VarDeltaOut.lkk">lkk</a>
                        </li>
                        <li>
                                <a class="function" href="#VarDeltaOut.get_process_args">get_process_args</a>
                        </li>
                        <li>
                                <a class="function" href="#VarDeltaOut.p_vardeltaout">p_vardeltaout</a>
                        </li>
                        <li>
                                <a class="variable" href="#VarDeltaOut.flux">flux</a>
                        </li>
                        <li>
                                <a class="variable" href="#VarDeltaOut.rate">rate</a>
                        </li>
                        <li>
                                <a class="variable" href="#VarDeltaOut.reservoir">reservoir</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleFlux">ScaleFlux</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ScaleFlux.__init__">ScaleFlux</a>
                        </li>
                        <li>
                                <a class="function" href="#ScaleFlux.get_process_args">get_process_args</a>
                        </li>
                        <li>
                                <a class="function" href="#ScaleFlux.p_scale_flux">p_scale_flux</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleFlux.flux">flux</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleFlux.rate">rate</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleFlux.ref_reservoirs">ref_reservoirs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleFlux.reservoir">reservoir</a>
                        </li>
                        <li>
                                <a class="variable" href="#ScaleFlux.scale">scale</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Reaction">Reaction</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#FluxDiff">FluxDiff</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FluxDiff.__init__">FluxDiff</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Fractionation">Fractionation</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Fractionation.__init__">Fractionation</a>
                        </li>
                        <li>
                                <a class="function" href="#Fractionation.get_process_args">get_process_args</a>
                        </li>
                        <li>
                                <a class="function" href="#Fractionation.p_fractionation">p_fractionation</a>
                        </li>
                        <li>
                                <a class="variable" href="#Fractionation.flux">flux</a>
                        </li>
                        <li>
                                <a class="variable" href="#Fractionation.reservoir">reservoir</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#RateConstant">RateConstant</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RateConstant.__init__">RateConstant</a>
                        </li>
                        <li>
                                <a class="variable" href="#RateConstant.lkk">lkk</a>
                        </li>
                        <li>
                                <a class="variable" href="#RateConstant.flux">flux</a>
                        </li>
                        <li>
                                <a class="variable" href="#RateConstant.k_value">k_value</a>
                        </li>
                        <li>
                                <a class="variable" href="#RateConstant.ref_value">ref_value</a>
                        </li>
                        <li>
                                <a class="variable" href="#RateConstant.reservoir">reservoir</a>
                        </li>
                        <li>
                                <a class="variable" href="#RateConstant.scale">scale</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleRelativeToConcentration">ScaleRelativeToConcentration</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ScaleRelativeToConcentration.get_process_args">get_process_args</a>
                        </li>
                        <li>
                                <a class="function" href="#ScaleRelativeToConcentration.p_scale_relative_to_concentration">p_scale_relative_to_concentration</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleRelativeToMass">ScaleRelativeToMass</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ScaleRelativeToMass.get_process_args">get_process_args</a>
                        </li>
                        <li>
                                <a class="function" href="#ScaleRelativeToMass.p_scale_relative_to_mass">p_scale_relative_to_mass</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ScaleRelative2otherReservoir">ScaleRelative2otherReservoir</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#Flux_Balance">Flux_Balance</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#Monod">Monod</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Monod.__init__">Monod</a>
                        </li>
                        <li>
                                <a class="variable" href="#Monod.lkk">lkk</a>
                        </li>
                </ul>

            </li>
    </ul>


                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
<a href="./../esbmtk.html">esbmtk</a>.processes    </h1>

                
                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">nptyping</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">set_printoptions</span><span class="p">,</span> <span class="n">arange</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">mean</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span><span class="p">,</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">process_time</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">numba.typed</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">builtins</span>

<span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># from .utility_functions import *</span>
<span class="kn">from</span> <span class="nn">.esbmtk</span> <span class="kn">import</span> <span class="n">esbmtkBase</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Flux</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span>
<span class="kn">from</span> <span class="nn">.utility_functions</span> <span class="kn">import</span> <span class="n">sort_by_type</span>
<span class="kn">from</span> <span class="nn">.solver</span> <span class="kn">import</span> <span class="n">get_imass</span><span class="p">,</span> <span class="n">get_frac</span><span class="p">,</span> <span class="n">get_delta</span><span class="p">,</span> <span class="n">get_flux_data</span>

<span class="c1"># from .connections import ConnnectionGroup</span>


<span class="k">class</span> <span class="nc">Process</span><span class="p">(</span><span class="n">esbmtkBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class defines template for process which acts on one or more</span>
<span class="sd">    reservoir flux combinations. To use it, you need to create an</span>
<span class="sd">    subclass which defines the actual process implementation in their</span>
<span class="sd">    call method. See &#39;PassiveFlux as example&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="s2">&quot;direction&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>  <span class="c1"># default error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="s2">&quot;a string&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__postinit__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Do some housekeeping for the process class&quot;&quot;&quot;</span>

        <span class="c1"># legacy name aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># display name of species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">:</span> <span class="n">Reservoir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">mo</span>  <span class="c1"># the model handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>

        <span class="c1"># self.rm0: float = self.r.m[0]  # the initial reservoir mass</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Flux</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">lio</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__misc_init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__delayed_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize stuff which is only known after the entire model has been defined.</span>
<span class="sd">        This will be executed just before running the model. You need to add the following</span>
<span class="sd">        two lines somewhere in the init procedure (preferably by redefining __misc_init__)</span>
<span class="sd">        and redefine __delayed_init__ to actually execute any code below</span>

<span class="sd">        # this process requires delayed init</span>
<span class="sd">        self.mo.lto.append(self)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__misc_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This is just a place holder method which will be called by default</span>
<span class="sd">        in __post_init__() This can be overloaded to add additional</span>
<span class="sd">        code to the init procedure without the need to redefine</span>
<span class="sd">        init. This useful for processes which only define a call method.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__defaultnames__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set up the default names and dicts for the process class. This</span>
<span class="sd">        allows us to extend these values without modifying the entire init process</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">ConnectionGroup</span>
        <span class="kn">from</span> <span class="nn">esbmtk</span> <span class="kn">import</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">Flux</span>

        <span class="c1"># provide a dict of known keywords and types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;delta&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;lt&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Flux</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ConnectionGroup</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">Flux</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># provide a list of absolutely required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="c1"># list of default values if none provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lod</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># default type hints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">:</span> <span class="n">Number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">:</span> <span class="n">Number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">:</span> <span class="n">Number</span>

    <span class="k">def</span> <span class="nf">__register__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">flux</span><span class="p">:</span> <span class="n">Flux</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Register the flux/reservoir pair we are acting upon, and register</span>
<span class="sd">        the process with the reservoir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># register the reservoir flux combination we are acting on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="n">flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">:</span> <span class="n">Reservoir</span> <span class="o">=</span> <span class="n">reservoir</span>
        <span class="c1"># add this process to the list of processes acting on this reservoir</span>
        <span class="n">reservoir</span><span class="o">.</span><span class="n">lop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">flux</span><span class="o">.</span><span class="n">lop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the current process to the vector x, and show the result as y.</span>
<span class="sd">        The resulting figure will be automatically saved.</span>

<span class="sd">        Example::</span>
<span class="sd">             process_name.show_figure(x,y)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">GenericFunction</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Process class takes a generic function and up to 6 optional</span>
<span class="sd">     function arguments, and will replace the mass value(s) of the</span>
<span class="sd">     given reservoirs with whatever the function calculates. This is</span>
<span class="sd">     particularly useful e.g., to calculate the pH of a given reservoir</span>
<span class="sd">     as function of e.g., Alkalinity and DIC.</span>

<span class="sd">     Parameters:</span>
<span class="sd">      - name = name of process,</span>
<span class="sd">      - act_on = name of a reservoir this process will act upon</span>
<span class="sd">      - function  = a function reference</span>
<span class="sd">      - a1 to a3,</span>

<span class="sd">     in order to use this function we need first declare a function we plan to</span>
<span class="sd">     use with the generic function process. This function needs to follow the</span>
<span class="sd">     below template.</span>

<span class="sd">    In order to be compatible with the numba solver, a1 and a2 must be</span>
<span class="sd">    an array of 1-D numpy.arrays i.e., [m, l, h, c]. The array can have</span>
<span class="sd">    any number of arrays though. a3 must be single array (or list)</span>
<span class="sd">    containing an arbitrary number of entries. All numbers in a1 to a3</span>
<span class="sd">    _must_ be of type float64.</span>

<span class="sd">    The function must return a list of numbers which correspond to the</span>
<span class="sd">    data which describe a reservoir i.e., mass, light isotope, heavy</span>
<span class="sd">    isotope, delta, and concentration</span>

<span class="sd">    In order to use this function we need first declare a function we plan to</span>
<span class="sd">    use with the generic function process. This function needs to follow this</span>
<span class="sd">    template::</span>

<span class="sd">        def my_func(i, a1, a2, a3) -&gt; tuple:</span>
<span class="sd">            #</span>
<span class="sd">            # i = index of the current timestep</span>
<span class="sd">            # a1 to a2 =  optional function parameter. These must be present,</span>
<span class="sd">            # even if your function will not use it</span>
<span class="sd">            # will be applied to this reservoir.</span>

<span class="sd">            # calc some stuff and return it as</span>

<span class="sd">            return [m, l, h, d, c] # where m= mass, and l &amp; h are the respective</span>
<span class="sd">                                   # isotopes. d denotes the delta value and</span>
<span class="sd">                                   # c the concentration</span>
<span class="sd">                                   # Use dummy value as necessary.</span>


<span class="sd">         This function can then be used as::</span>

<span class="sd">         GenericFunction(name=&quot;foo&quot;,</span>
<span class="sd">                 function=my_func,</span>
<span class="sd">                 a1 = some argument,</span>
<span class="sd">                 a2 = some argument,</span>
<span class="sd">                 a3 = some argument</span>
<span class="sd">                 a4 = some argument</span>
<span class="sd">                 acton_on = reservoir reference</span>
<span class="sd">                 )</span>

<span class="sd">     see calc_H in the carbonate chemistry module as example</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;act_on&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;i&quot;</span><span class="p">,</span>
        <span class="s2">&quot;act_on&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># list of allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Flux</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="nb">any</span><span class="p">),</span>
            <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># required arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;act_on&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">]</span>

        <span class="c1"># list of default values if none provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lod</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">any</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>  <span class="c1"># default error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="s2">&quot;a reservoir or flux&quot;</span><span class="p">,</span>
                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;a function&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numba List&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;function must be defined before it can be used here&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>  <span class="c1">#</span>

        <span class="c1"># register with reservoir</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">lpc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># register with Reservoir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span><span class="o">.</span><span class="n">lpc_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register with Model</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="p">,</span> <span class="n">Flux</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">lpc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># register with Flux</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span><span class="o">.</span><span class="n">lpc_f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register with Model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;functions can only act upon reservoirs or fluxes&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we execute the user supplied function and assign the</span>
<span class="sd">        return value to the flux or reservoir</span>

<span class="sd">        Where i = index of the current timestep</span>
<span class="sd">              acting_on = reservoir or flux we are acting on.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a4</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">r</span>

    <span class="c1"># redefine post init</span>
    <span class="k">def</span> <span class="nf">__postinit__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Do some housekeeping for the process class&quot;&quot;&quot;</span>

        <span class="c1"># legacy name aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># display name of species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span>  <span class="c1"># the model handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__misc_init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;return the data associated with this object&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">func_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a4</span><span class="p">,</span>
            <span class="c1"># List(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">l</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="c1"># ),</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">LookupTable</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process replaces the flux-values with values from a static</span>
<span class="sd">    lookup table</span>

<span class="sd">         Example::</span>

<span class="sd">         LookupTable(&quot;name&quot;, upstream_reservoir_handle, lt=flux-object)</span>

<span class="sd">         where the flux-object contains the mass, li, hi, and delta values</span>
<span class="sd">         which will replace the current flux values.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we replace the flux value with the value from the flux object</span>
<span class="sd">        which we use as a lookup-table</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">AddSignal</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process adds values to the current flux based on the values provided by the sifnal object.</span>
<span class="sd">    This class is typically invoked through the connector object</span>

<span class="sd">     Example::</span>

<span class="sd">     AddSignal(name = &quot;name&quot;,</span>
<span class="sd">               reservoir = upstream_reservoir_handle,</span>
<span class="sd">               flux = flux_to_act_upon,</span>
<span class="sd">               lt = flux with lookup values)</span>

<span class="sd">     where - the upstream reservoir is the reservoir the process belongs too</span>
<span class="sd">             the flux is the flux to act upon</span>
<span class="sd">             lt= contains the flux object we lookup from</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;lt&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide whichh call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>

    <span class="c1"># setup a placeholder call function</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="c1"># use this when we do isotopes</span>
    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Each process is associated with a flux (self.f). Here we replace</span>
<span class="sd">        the flux value with the value from the signal object which</span>
<span class="sd">        we use as a lookup-table (self.lt)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add signal mass to flux mass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># self.f[i] = self.f[i] + self.lt[i]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_imass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">r</span><span class="o">.</span><span class="n">rvalue</span><span class="p">)</span>
        <span class="c1"># signals may have zero mass, but may have a delta offset. Thus, we do not know</span>
        <span class="c1"># the masses for the light and heavy isotope. As such we have to calculate the masses</span>
        <span class="c1"># after we add the signal to a flux</span>

    <span class="c1"># use this when we do isotopes</span>
    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Each process is associated with a flux (self.f). Here we replace</span>
<span class="sd">        the flux value with the value from the signal object which</span>
<span class="sd">        we use as a lookup-table (self.lt)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add signal mass to flux mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">PassiveFlux</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process sets the output flux from a reservoir to be equal to</span>
<span class="sd">    the sum of input fluxes, so that the reservoir concentration does</span>
<span class="sd">    not change. Furthermore, the isotopic ratio of the output flux</span>
<span class="sd">    will be set equal to the isotopic ratio of the reservoir The init</span>
<span class="sd">    and register methods are inherited from the process class. The</span>
<span class="sd">    overall result can be scaled, i.e., in order to create a split flow etc.</span>
<span class="sd">    Example::</span>

<span class="sd">    PassiveFlux(name = &quot;name&quot;,</span>
<span class="sd">                reservoir = upstream_reservoir_handle</span>
<span class="sd">                flux = flux handle)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__misc_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This is just a place holder method which will be called by default</span>
<span class="sd">        in __post_init__() This can be overloaded to add additional</span>
<span class="sd">        code to the init procedure without the need to redefine</span>
<span class="sd">        init. This useful for processes which only define a call method.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># this process requires delayed init.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span><span class="o">.</span><span class="n">lto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delayed_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize stuff which is only known after the entire model has been defined.</span>
<span class="sd">        This will be executed just before running the model.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create a list of fluxes wich excludes the flux this process</span>
        <span class="c1"># will be acting upon</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;delayed init for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fws</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Flux</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">lof</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fws</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># remove this handle</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we re-balance the flux. That is, we calculate the sum of all fluxes</span>
<span class="sd">        excluding this flux. This sum will be equal to this flux. This will likely only</span>
<span class="sd">        work for outfluxes though.</span>

<span class="sd">        Should this be done for output fluxes as well?</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># calc sum of fluxes in fws. Note that at this point, not all fluxes</span>
        <span class="c1"># will be known so we need to use the flux values from the previous times-step</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fws</span><span class="p">):</span>
            <span class="c1"># print(f&quot;{f.n} = {f.m[i-1] * reservoir.lio[f]}&quot;)</span>
            <span class="n">new</span> <span class="o">+=</span> <span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">lio</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>

        <span class="c1"># print(f&quot;sum = {new:.0f}\n&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_flux_data</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">rvalue</span><span class="p">)</span>

        <span class="c1"># m = new</span>
        <span class="c1"># r = reservoir.l[i - 1] / reservoir.m[i - 1]</span>
        <span class="c1"># l = m * r</span>
        <span class="c1"># h = m - l</span>
        <span class="c1"># self.f.m[i] = m</span>
        <span class="c1"># self.f.l[i] = l</span>
        <span class="c1"># self.f.h[i] = h</span>

    <span class="c1"># self.f.d[i] = reservoir.d[i - 1]</span>


<span class="k">class</span> <span class="nc">PassiveFlux_fixed_delta</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process sets the output flux from a reservoir to be equal to</span>
<span class="sd">    the sum of input fluxes, so that the reservoir concentration does</span>
<span class="sd">    not change. However, the isotopic ratio of the output flux is set</span>
<span class="sd">    at a fixed value. The init and register methods are inherited</span>
<span class="sd">    from the process class. The overall result can be scaled, i.e.,</span>
<span class="sd">    in order to create a split flow etc.  Example::</span>

<span class="sd">    PassiveFlux_fixed_delta(name = &quot;name&quot;,</span>
<span class="sd">                            reservoir = upstream_reservoir_handle,</span>
<span class="sd">                            flux handle,</span>
<span class="sd">                            delta = delta offset)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># legacy names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">n *** Warning, you selected the PassiveFlux_fixed_delta method ***</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot; This is not a particularly phyiscal process is this really what you want?</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we re-balance the flux. This code will be called by the</span>
<span class="sd">        apply_flux_modifier method of a reservoir which itself is</span>
<span class="sd">        called by the model execute method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">rvalue</span>  <span class="c1"># the isotope reference value</span>

        <span class="n">varflux</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">flux_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Flux</span><span class="p">]</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">lof</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">flux_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">varflux</span><span class="p">)</span>  <span class="c1"># remove this handle</span>

        <span class="c1"># sum up the remaining fluxes</span>
        <span class="n">newflux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flux_list</span><span class="p">:</span>
            <span class="n">newflux</span> <span class="o">=</span> <span class="n">newflux</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">lio</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>

        <span class="c1"># set isotope mass according to keyword value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">get_flux_data</span><span class="p">(</span><span class="n">newflux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">VarDeltaOut</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unlike a passive flux, this process sets the flux istope ratio</span>
<span class="sd">    equal to the isotopic ratio of the reservoir. The</span>
<span class="sd">    init and register methods are inherited from the process</span>
<span class="sd">    class.</span>

<span class="sd">    VarDeltaOut(name = &quot;name&quot;,</span>
<span class="sd">                reservoir = upstream_reservoir_handle,</span>
<span class="sd">                flux = flux handle,</span>
<span class="sd">                rate = rate,)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">ConnectionGroup</span>
        <span class="kn">from</span> <span class="nn">esbmtk</span> <span class="kn">import</span> <span class="n">Flux</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">ReservoirGroup</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Q_</span><span class="p">),</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">ConnectionGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Flux</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="c1"># print(</span>
            <span class="c1">#    f&quot;vardeltaout with isotopes for {self.reservoir.register.name}.{self.reservoir.name}&quot;</span>
            <span class="c1"># )</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">):</span>
                <span class="c1"># print(&quot;Using reservoir&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes_reservoir__</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
                <span class="c1"># print(&quot;Using Source&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes_source__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, reservoir must be of type Source or Reservoir, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>

    <span class="c1"># setup a placeholder call function</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span><span class="p">(</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__with_isotopes_reservoir__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we re-balance the flux. This code will be called by the</span>
<span class="sd">        apply_flux_modifier method of a reservoir which itself is</span>
<span class="sd">        called by the model execute method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># if reservoir.register.name == &quot;db&quot;:</span>
            <span class="c1">#    print(f&quot;{reservoir.name} d={reservoir.d[i-1]}&quot;)</span>
            <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
            <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
            <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="c1"># if upstream is a source, we only have a single delta value</span>
        <span class="c1"># so we need to patch this. Maybe this should move to source?</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_vardeltaout</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)])</span>

        <span class="c1"># print(f&quot;rd = {res_data[2][0]}, fd = {flux_data[0][0]}&quot;)</span>
        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_vardeltaout</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="c1"># res_data[0] is actually flux data. See get_process args for details</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># r mass</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">__with_isotopes_source__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;If the source of the flux is a source, there is only a single delta value.</span>
<span class="sd">        Changes to the flux delta are applied through the Signal class.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">delta</span>
            <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
            <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
            <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we re-balance the flux. This code will be called by the</span>
<span class="sd">        apply_flux_modifier method of a reservoir which itself is</span>
<span class="sd">        called by the model execute method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ScaleFlux</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process scales the mass of a flux (m,l,h) relative to another</span>
<span class="sd">    flux but does not affect delta. The scale factor &quot;scale&quot; and flux</span>
<span class="sd">    reference must be present when the object is being initalized</span>

<span class="sd">    Example::</span>
<span class="sd">         ScaleFlux(name = &quot;Name&quot;,</span>
<span class="sd">                   reservoir = reservoir_handle (upstream or downstream)</span>
<span class="sd">                   scale = 1</span>
<span class="sd">                   ref_reservoirs = flux we use for scale)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>

    <span class="c1"># setup a placeholder call function</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span><span class="p">(</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the scale factor. This is typically done through the the</span>
<span class="sd">        model execute method.</span>
<span class="sd">        Note that this will use the mass of the reference object, but that we will set the</span>
<span class="sd">        delta according to the reservoir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the scale factor. This is typically done through the the</span>
<span class="sd">        model execute method.</span>
<span class="sd">        Note that this will use the mass of the reference object, but that we will set the</span>
<span class="sd">        delta according to the reservoir (or the flux?)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_flux</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="o">.</span><span class="n">m</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_flux</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="c1"># print(f&quot;ScaleFlux m = {m:.2e}, scale = {proc_const[1]}&quot;)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>


<span class="k">class</span> <span class="nc">Reaction</span><span class="p">(</span><span class="n">ScaleFlux</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process approximates the effect of a chemical reaction between</span>
<span class="sd">    two fluxes which belong to a differents species (e.g., S, and O).</span>
<span class="sd">    The flux belonging to the upstream reservoir will simply be</span>
<span class="sd">    scaled relative to the flux it reacts with. The scaling is given</span>
<span class="sd">    by the ratio argument. So this function is equivalent to the</span>
<span class="sd">    ScaleFlux class.</span>

<span class="sd">    Example::</span>

<span class="sd">       Connect(source=IW_H2S,</span>
<span class="sd">               sink=S0,</span>
<span class="sd">               ctype = &quot;react_with&quot;,</span>
<span class="sd">               scale=1,</span>
<span class="sd">               ref_reservoirs = O2_diff_to_S0,</span>
<span class="sd">               scale =1,</span>
<span class="sd">       )</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">FluxDiff</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The new flux will be the difference of two fluxes&quot;&quot;&quot;</span>

    <span class="sd">&quot;&quot;&quot;This process scales the mass of a flux (m,l,h) relative to another</span>
<span class="sd">     flux but does not affect delta. The scale factor &quot;scale&quot; and flux</span>
<span class="sd">     reference must be present when the object is being initalized</span>

<span class="sd">     Example::</span>
<span class="sd">          ScaleFlux(name = &quot;Name&quot;,</span>
<span class="sd">                    reservoir = upstream_reservoir_handle,</span>
<span class="sd">                    scale = 1</span>
<span class="sd">                    ref_reservoirs = flux we use for scale)</span>

<span class="sd">     &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the scale factor. This is typically done through the the</span>
<span class="sd">        model execute method.</span>
<span class="sd">        Note that this will use the mass of the reference object, but that we will set the</span>
<span class="sd">        delta according to the reservoir (or the flux?)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>


<span class="k">class</span> <span class="nc">Fractionation</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process offsets the isotopic ratio of the flux by a given</span>
<span class="sd">       delta value. In other words, we add a fractionation factor</span>

<span class="sd">    Example::</span>
<span class="sd">         Fractionation(name = &quot;Name&quot;,</span>
<span class="sd">                       reservoir = upstream_reservoir_handle,</span>
<span class="sd">                       flux = flux handle</span>
<span class="sd">                       alpha = 12 in permil (e.f)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># alpha is given in permil, but the fractionation routine expects</span>
        <span class="c1"># it as 1 + permil, i.e., 70 permil would 1.007</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set flux isotope masses based on fractionation factor</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(f&quot;delta before = {get_delta(self.f.l[i], self.f.h[i], self.f.rvalue)}&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_frac</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">alp</span><span class="p">)</span>
            <span class="c1"># update delta</span>
            <span class="c1"># self.f.d[i] = get_delta(self.f.l[i], self.f.h[i], self.f.rvalue)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
            <span class="c1"># print(f&quot;delta after = {get_delta(self.f.l[i], self.f.h[i], self.f.rvalue)}\n&quot;)</span>

        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_fractionation</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_fractionation</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>


<span class="k">class</span> <span class="nc">RateConstant</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a wrapper for a variety of processes which depend on rate constants</span>
<span class="sd">    Please see the below class definitions for details on how to call them</span>
<span class="sd">    At present, the following processes are defined</span>

<span class="sd">    ScaleRelativeToNormalizedConcentration</span>
<span class="sd">    ScaleRelativeToConcentration</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_value&quot;</span><span class="p">,</span> <span class="s2">&quot;k_value&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">SourceGroup</span><span class="p">,</span> <span class="n">SinkGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">ConnectionGroup</span>
        <span class="kn">from</span> <span class="nn">esbmtk</span> <span class="kn">import</span> <span class="n">Flux</span>

        <span class="c1"># Note that self.lkk values also need to be added to the lkk</span>
        <span class="c1"># list of the connector object.</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># update the allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;k_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">),</span>
            <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">),</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">SourceGroup</span><span class="p">,</span>
                <span class="n">SinkGroup</span><span class="p">,</span>
                <span class="n">ReservoirGroup</span><span class="p">,</span>
                <span class="n">ConnectionGroup</span><span class="p">,</span>
                <span class="n">Flux</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;k_value&quot;</span><span class="p">]])</span>

        <span class="c1"># dict with default values if none provided</span>
        <span class="c1"># self.lod = {r</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>

        <span class="c1"># add these terms to the known error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="s2">&quot;Reservoir handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">:</span> <span class="s2">&quot;List of Reservoir handle(s)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number or flux quantity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;a string value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="s2">&quot;a flux handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;list, reservoir or number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s2">&quot;list, reservoir or number&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># xxx if self.register != &quot;None&quot;:</span>
        <span class="c1">#    self.name = f&quot;{self.register}.{self.name}&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>

    <span class="c1"># setup a placeholder call function</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span><span class="p">(</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>


<span class="c1"># class ScaleRelativeToNormalizedConcentration(RateConstant):</span>
<span class="c1">#     &quot;&quot;&quot;This process scales the flux as a function of the upstream</span>
<span class="c1">#      reservoir concentration C and a constant which describes the</span>
<span class="c1">#      strength of relation between the reservoir concentration and</span>
<span class="c1">#      the flux scaling</span>

<span class="c1">#      F = (C/C0 -1) * k</span>

<span class="c1">#      where C denotes the concentration in the ustream reservoir, C0</span>
<span class="c1">#      denotes the baseline concentration and k is a constant</span>
<span class="c1">#      This process is typically called by the connector</span>
<span class="c1">#      instance. However you can instantiate it manually as</span>


<span class="c1">#      ScaleRelativeToNormalizedConcentration(</span>
<span class="c1">#                        name = &quot;Name&quot;,</span>
<span class="c1">#                        reservoir= upstream_reservoir_handle,</span>
<span class="c1">#                        flux = flux handle,</span>
<span class="c1">#                        Scale =  1000,</span>
<span class="c1">#                        ref_value = 2 # reference_concentration</span>
<span class="c1">#     )</span>

<span class="c1">#     &quot;&quot;&quot;</span>

<span class="c1">#     def __call__(self, reservoir: Reservoir, i: int) -&gt; None:</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         this will be called by the Model.run() method</span>
<span class="c1">#         &quot;&quot;&quot;</span>

<span class="c1">#         scale: float = (reservoir.c[i - 1] / self.ref_value - 1) * self.scale</span>
<span class="c1">#         # scale = scale * (scale &gt;= 0)  # prevent negative fluxes.</span>
<span class="c1">#         self.f[i] = self.f[i] + self.f[i] * array([scale, scale, scale, 1])</span>

<span class="c1"># from numba import typed, typeof, types</span>
<span class="c1"># from numba.experimental import jitclass</span>
<span class="c1"># import numba</span>

<span class="c1"># lmo = typed.List()</span>
<span class="c1"># ldo = typed.List()</span>
<span class="c1"># reg_time = types.float64</span>

<span class="c1"># spec = [</span>
<span class="c1">#     (&quot;reservoir.m&quot;, numba.float64[:]),</span>
<span class="c1">#     (&quot;i&quot;, numba.int32),</span>
<span class="c1">#     (&quot;reservoir.volume&quot;, numba.float64),</span>
<span class="c1">#     (&quot;scale&quot;, numba.float64),</span>
<span class="c1">#     (&quot;flux.m&quot;, numba.float64[:]),</span>
<span class="c1">#     (&quot;reservoir.species.element.r&quot;, numba.float64),</span>
<span class="c1">#     (&quot;reservoir.d&quot;, numba.float64[:]),</span>
<span class="c1"># ]</span>


<span class="c1"># @jitclass(spec)</span>
<span class="k">class</span> <span class="nc">ScaleRelativeToConcentration</span><span class="p">(</span><span class="n">RateConstant</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process calculates the flux as a function of the upstream</span>
<span class="sd">     reservoir concentration C and a constant which describes thet</span>
<span class="sd">     strength of relation between the reservoir concentration and</span>
<span class="sd">     the flux scaling</span>

<span class="sd">     F = C * k</span>

<span class="sd">     where C denotes the concentration in the ustream reservoir, k is a</span>
<span class="sd">     constant. This process is typically called by the connector</span>
<span class="sd">     instance. However you can instantiate it manually as</span>

<span class="sd">     ScaleRelativeToConcentration(</span>
<span class="sd">                       name = &quot;Name&quot;,</span>
<span class="sd">                       reservoir= upstream_reservoir_handle,</span>
<span class="sd">                       flux = flux handle,</span>
<span class="sd">                       Scale =  1000,</span>
<span class="sd">    )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># otherwise there is no flux</span>
            <span class="c1"># convert to concentration</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">volume</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        C = M/V so we express this as relative to mass which allows us to</span>
<span class="sd">        use the isotope data.</span>

<span class="sd">        The below calculates the flux as function of reservoir concentration,</span>
<span class="sd">        rather than scaling the flux.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># otherwise there is no flux</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
            <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
            <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_relative_to_concentration</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_relative_to_concentration</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>


<span class="k">class</span> <span class="nc">ScaleRelativeToMass</span><span class="p">(</span><span class="n">RateConstant</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process scales the flux as a function of the upstream</span>
<span class="sd">     reservoir Mass M and a constant which describes the</span>
<span class="sd">     strength of relation between the reservoir mass and</span>
<span class="sd">     the flux scaling</span>

<span class="sd">     F = F0 *  M * k</span>

<span class="sd">     where M denotes the mass in the ustream reservoir, k is a</span>
<span class="sd">     constant and F0 is the initial unscaled flux. This process is</span>
<span class="sd">     typically called by the connector instance. However you can</span>
<span class="sd">     instantiate it manually as</span>

<span class="sd">     Note that we scale the flux, rather than compute the flux!</span>

<span class="sd">     This is faster than setting a new flux, computing the isotope</span>
<span class="sd">     ratio and setting delta. So you either have to set the initial</span>
<span class="sd">     flux F0 to 1, or calculate the scale accordingly</span>

<span class="sd">     ScaleRelativeToMass(</span>
<span class="sd">                       name = &quot;Name&quot;,</span>
<span class="sd">                       reservoir= upstream_reservoir_handle,</span>
<span class="sd">                       flux = flux handle,</span>
<span class="sd">                       Scale =  1000,</span>
<span class="sd">    )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this will be called by the Model.run() method</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the data associated with this object&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_relative_to_mass</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_relative_to_mass</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

    <span class="c1"># def p_scale_relative_to_mass(res_data, flux_data, proc_const, i) -&gt; tuple:</span>

    <span class="c1">#     m: float = res_data[0][i - 1] * proc_const[1]</span>
    <span class="c1">#     d: float = res_data[1][i - 1]</span>
    <span class="c1">#     l: float = (1000.0 * m) / ((d + 1000.0) * proc_const[0] + 1000.0)</span>
    <span class="c1">#     return [m, l, m - l, d]</span>


<span class="c1"># class ScaleRelativeToNormalizedMass(RateConstant):</span>
<span class="c1">#     &quot;&quot;&quot;This process scales the flux as a function of the upstream</span>
<span class="c1">#      reservoir mass M and a constant which describes the</span>
<span class="c1">#      strength of relation between the reservoir concentration and</span>
<span class="c1">#      the flux scaling</span>

<span class="c1">#      F = (M/M0 -1) * k</span>

<span class="c1">#      where M denotes the mass in the ustream reservoir, M0</span>
<span class="c1">#      denotes the reference mass, and k is a constant</span>
<span class="c1">#      This process is typically called by the connector</span>
<span class="c1">#      instance. However you can instantiate it manually as</span>


<span class="c1">#      ScaleRelativeToNormalizedConcentration(</span>
<span class="c1">#                        name = &quot;Name&quot;,</span>
<span class="c1">#                        reservoir= upstream_reservoir_handle,</span>
<span class="c1">#                        flux = flux handle,</span>
<span class="c1">#                        Scale =  1,</span>
<span class="c1">#                        ref_value = 1e5 # reference_mass</span>
<span class="c1">#     )</span>

<span class="c1">#     &quot;&quot;&quot;</span>

<span class="c1">#     def __call__(self, reservoir: Reservoir, i: int) -&gt; None:</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         this will be called by the Model.run() method</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         scale: float = (reservoir.m[i - 1] / self.ref_value - 1) * self.scale</span>
<span class="c1">#         # scale = scale * (scale &gt;= 0)  # prevent negative fluxes.</span>
<span class="c1">#         self.f[i] = self.f[i] + self.f[i] * array([scale, scale, scale, 1])</span>


<span class="k">class</span> <span class="nc">ScaleRelative2otherReservoir</span><span class="p">(</span><span class="n">RateConstant</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process scales the flux as a function one or more reservoirs</span>
<span class="sd">    constant which describes the</span>
<span class="sd">    strength of relation between the reservoir concentration and</span>
<span class="sd">    the flux scaling</span>

<span class="sd">    F = C1 * C1 * k</span>

<span class="sd">    where Mi denotes the concentration in one  or more reservoirs, k is one</span>
<span class="sd">    or more constant(s). This process is typically called by the connector</span>
<span class="sd">    instance when you specify the connection as</span>

<span class="sd">    Connect(source =  upstream reservoir,</span>
<span class="sd">              sink = downstream reservoir,</span>
<span class="sd">              ctype = &quot;scale_relative_to_multiple_reservoirs&quot;</span>
<span class="sd">              ref_reservoirs = [r1, r2, k etc] # you must provide at least one</span>
<span class="sd">                                               # reservoir or constant</span>
<span class="sd">              scale = a overall scaling factor</span>
<span class="sd">           )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__misc_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Test that self.reservoir only contains numbers and reservoirs&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span> <span class="n">Number</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">Number</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">*</span> <span class="n">r</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2"> must be reservoir or number, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>

        <span class="c1"># scale = scale * (scale &gt;= 0)  # prevent negative fluxes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        not sure that this correct WRT isotopes</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Scale relative to multiple reservoirs is undefined for isotope calculations&quot;</span>
        <span class="p">)</span>

        <span class="c1"># c: float = 1</span>
        <span class="c1"># for r in self.rs:</span>
        <span class="c1">#     c = c * r.c[i - 1]</span>

        <span class="c1"># scale: float = c * self.scale * self.constant</span>

        <span class="c1"># # scale = scale * (scale &gt;= 0)  # prevent negative fluxes.</span>
        <span class="c1"># self.f[i] = [scale, scale, scale, 1]</span>


<span class="k">class</span> <span class="nc">Flux_Balance</span><span class="p">(</span><span class="n">RateConstant</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process calculates a flux between two reservoirs as a function</span>
<span class="sd">    of multiple reservoir concentrations and constants.</span>

<span class="sd">    Note that could result in negative fluxes. which might cause</span>
<span class="sd">    issues with isotope ratios (untested)</span>

<span class="sd">    This will work with equilibrium reactions between two reservoirs where the</span>
<span class="sd">    reaction can be described as</span>

<span class="sd">    K * [R1] = R[2] * [R3]</span>

<span class="sd">    you can have more than two terms on each side as long as they are</span>
<span class="sd">    constants or reservoirs</span>

<span class="sd">    Equilibrium(</span>
<span class="sd">                name = &quot;Name&quot;,</span>
<span class="sd">                reservoir = reservoir handle,</span>
<span class="sd">                left = [] # list with reservoir names or constants</span>
<span class="sd">                right = [] # list with reservoir names or constants</span>
<span class="sd">                flux = flux handle,</span>
<span class="sd">                k_value = a constant, defaults to 1</span>
<span class="sd">    )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># redefine misc_init which is being called by post-init</span>
    <span class="k">def</span> <span class="nf">__misc_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sort out input variables&quot;&quot;&quot;</span>

        <span class="n">Rl</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Reservoir</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Rr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Reservoir</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Cl</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Cr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># parse the left hand side</span>

        <span class="n">em</span> <span class="o">=</span> <span class="s2">&quot;left/right values must be constants or reservoirs&quot;</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Rl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cl</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_by_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="p">[</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span> <span class="n">em</span><span class="p">)</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Rr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_by_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="p">[</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span> <span class="n">em</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this will be called by the Model.run() method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">kl</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">kr</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

        <span class="c1"># calculate the product of reservoir concentrations for left side</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rl</span><span class="p">:</span>
            <span class="n">kl</span> <span class="o">*=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># multiply with any any constants on the right</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cl</span><span class="p">:</span>
            <span class="n">kl</span> <span class="o">*=</span> <span class="n">c</span>

        <span class="c1"># calculate the product of reservoir concentrations for right side</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rr</span><span class="p">:</span>
            <span class="n">kr</span> <span class="o">*=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># multiply with any any constants on the right</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="p">:</span>
            <span class="n">kr</span> <span class="o">*=</span> <span class="n">c</span>

        <span class="c1"># set flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kl</span> <span class="o">-</span> <span class="n">kr</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_value</span>


<span class="k">class</span> <span class="nc">Monod</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process scales the flux as a function of the upstream</span>
<span class="sd">    reservoir concentration using a Michaelis Menten type</span>
<span class="sd">    relationship</span>

<span class="sd">    F = F * a * F0 x C/(b+C)</span>

<span class="sd">    where F0 denotes the unscaled flux (i.e., at t=0), C denotes</span>
<span class="sd">    the concentration in the ustream reservoir, and a and b are</span>
<span class="sd">    constants.</span>

<span class="sd">    Example::</span>
<span class="sd">         Monod(name = &quot;Name&quot;,</span>
<span class="sd">               reservoir =  upstream_reservoir_handle,</span>
<span class="sd">               flux = flux handle ,</span>
<span class="sd">               ref_value = reference concentration</span>
<span class="sd">               a_value = constant,</span>
<span class="sd">               b_value = constant )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>

        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># update the allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;a_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;b_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Q_</span><span class="p">),</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">SourceGroup</span><span class="p">,</span> <span class="n">SinkGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">ConnectionGroup</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;a_value&quot;</span><span class="p">,</span> <span class="s2">&quot;b_value&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_value&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;a_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;b_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="s2">&quot;Reservoir handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;a string value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="s2">&quot;a flux handle&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this willbe called by Model.execute apply_processes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a_value</span>
            <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_value</span> <span class="o">*</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_value</span> <span class="o">+</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># prevent negative fluxes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">__plot__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ref_reservoirs</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Test the implementation&quot;&quot;&quot;</span>

        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">ref_reservoirs</span> <span class="o">*</span> <span class="n">e</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">e</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>  <span class="c1">#</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="c1"># Create a scatter plot for ax</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

        </details>

            </section>
                <section id="Process">
                                <div class="attr class">
        <a class="headerlink" href="#Process">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Process</span>(<span class="base"><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Process</span><span class="p">(</span><span class="n">esbmtkBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class defines template for process which acts on one or more</span>
<span class="sd">    reservoir flux combinations. To use it, you need to create an</span>
<span class="sd">    subclass which defines the actual process implementation in their</span>
<span class="sd">    call method. See &#39;PassiveFlux as example&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;mo&quot;</span><span class="p">,</span> <span class="s2">&quot;direction&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>  <span class="c1"># default error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="s2">&quot;a string&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__postinit__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Do some housekeeping for the process class&quot;&quot;&quot;</span>

        <span class="c1"># legacy name aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># display name of species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">:</span> <span class="n">Reservoir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">mo</span>  <span class="c1"># the model handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>

        <span class="c1"># self.rm0: float = self.r.m[0]  # the initial reservoir mass</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Flux</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">lio</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__misc_init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__delayed_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize stuff which is only known after the entire model has been defined.</span>
<span class="sd">        This will be executed just before running the model. You need to add the following</span>
<span class="sd">        two lines somewhere in the init procedure (preferably by redefining __misc_init__)</span>
<span class="sd">        and redefine __delayed_init__ to actually execute any code below</span>

<span class="sd">        # this process requires delayed init</span>
<span class="sd">        self.mo.lto.append(self)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__misc_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This is just a place holder method which will be called by default</span>
<span class="sd">        in __post_init__() This can be overloaded to add additional</span>
<span class="sd">        code to the init procedure without the need to redefine</span>
<span class="sd">        init. This useful for processes which only define a call method.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__defaultnames__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Set up the default names and dicts for the process class. This</span>
<span class="sd">        allows us to extend these values without modifying the entire init process</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">ConnectionGroup</span>
        <span class="kn">from</span> <span class="nn">esbmtk</span> <span class="kn">import</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">Flux</span>

        <span class="c1"># provide a dict of known keywords and types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;delta&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;lt&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Flux</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ConnectionGroup</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">Flux</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># provide a list of absolutely required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="c1"># list of default values if none provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lod</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># default type hints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">:</span> <span class="n">Number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">:</span> <span class="n">Number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">:</span> <span class="n">Number</span>

    <span class="k">def</span> <span class="nf">__register__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">flux</span><span class="p">:</span> <span class="n">Flux</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Register the flux/reservoir pair we are acting upon, and register</span>
<span class="sd">        the process with the reservoir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># register the reservoir flux combination we are acting on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="n">flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">:</span> <span class="n">Reservoir</span> <span class="o">=</span> <span class="n">reservoir</span>
        <span class="c1"># add this process to the list of processes acting on this reservoir</span>
        <span class="n">reservoir</span><span class="o">.</span><span class="n">lop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">flux</span><span class="o">.</span><span class="n">lop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the current process to the vector x, and show the result as y.</span>
<span class="sd">        The resulting figure will be automatically saved.</span>

<span class="sd">        Example::</span>
<span class="sd">             process_name.show_figure(x,y)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class defines template for process which acts on one or more
reservoir flux combinations. To use it, you need to create an
subclass which defines the actual process implementation in their
call method. See 'PassiveFlux as example'</p>
</div>


                            <div id="Process.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Process.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Process</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>  <span class="c1"># default error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="s2">&quot;a string&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Create a new process object with a given process type and options</p>
</div>


                            </div>
                            <div id="Process.show_figure" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Process.show_figure">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">show_figure</span><span class="signature">(self, x, y) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">show_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the current process to the vector x, and show the result as y.</span>
<span class="sd">        The resulting figure will be automatically saved.</span>

<span class="sd">        Example::</span>
<span class="sd">             process_name.show_figure(x,y)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Apply the current process to the vector x, and show the result as y.
The resulting figure will be automatically saved.</p>

<p>Example::
     process_name.show_figure(x,y)</p>
</div>


                            </div>
                            <div id="Process.direction" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Process.direction">#&nbsp;&nbsp</a>

        <span class="name">direction</span><span class="default_value"> = &lt;member &#39;direction&#39; of &#39;Process&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="Process.flux" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Process.flux">#&nbsp;&nbsp</a>

        <span class="name">flux</span><span class="default_value"> = &lt;member &#39;flux&#39; of &#39;Process&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="Process.mo" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Process.mo">#&nbsp;&nbsp</a>

        <span class="name">mo</span><span class="default_value"> = &lt;member &#39;mo&#39; of &#39;Process&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="Process.r" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Process.r">#&nbsp;&nbsp</a>

        <span class="name">r</span><span class="default_value"> = &lt;member &#39;r&#39; of &#39;Process&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="Process.reservoir" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Process.reservoir">#&nbsp;&nbsp</a>

        <span class="name">reservoir</span><span class="default_value"> = &lt;member &#39;reservoir&#39; of &#39;Process&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="Process.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="GenericFunction">
                                <div class="attr class">
        <a class="headerlink" href="#GenericFunction">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">GenericFunction</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GenericFunction</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Process class takes a generic function and up to 6 optional</span>
<span class="sd">     function arguments, and will replace the mass value(s) of the</span>
<span class="sd">     given reservoirs with whatever the function calculates. This is</span>
<span class="sd">     particularly useful e.g., to calculate the pH of a given reservoir</span>
<span class="sd">     as function of e.g., Alkalinity and DIC.</span>

<span class="sd">     Parameters:</span>
<span class="sd">      - name = name of process,</span>
<span class="sd">      - act_on = name of a reservoir this process will act upon</span>
<span class="sd">      - function  = a function reference</span>
<span class="sd">      - a1 to a3,</span>

<span class="sd">     in order to use this function we need first declare a function we plan to</span>
<span class="sd">     use with the generic function process. This function needs to follow the</span>
<span class="sd">     below template.</span>

<span class="sd">    In order to be compatible with the numba solver, a1 and a2 must be</span>
<span class="sd">    an array of 1-D numpy.arrays i.e., [m, l, h, c]. The array can have</span>
<span class="sd">    any number of arrays though. a3 must be single array (or list)</span>
<span class="sd">    containing an arbitrary number of entries. All numbers in a1 to a3</span>
<span class="sd">    _must_ be of type float64.</span>

<span class="sd">    The function must return a list of numbers which correspond to the</span>
<span class="sd">    data which describe a reservoir i.e., mass, light isotope, heavy</span>
<span class="sd">    isotope, delta, and concentration</span>

<span class="sd">    In order to use this function we need first declare a function we plan to</span>
<span class="sd">    use with the generic function process. This function needs to follow this</span>
<span class="sd">    template::</span>

<span class="sd">        def my_func(i, a1, a2, a3) -&gt; tuple:</span>
<span class="sd">            #</span>
<span class="sd">            # i = index of the current timestep</span>
<span class="sd">            # a1 to a2 =  optional function parameter. These must be present,</span>
<span class="sd">            # even if your function will not use it</span>
<span class="sd">            # will be applied to this reservoir.</span>

<span class="sd">            # calc some stuff and return it as</span>

<span class="sd">            return [m, l, h, d, c] # where m= mass, and l &amp; h are the respective</span>
<span class="sd">                                   # isotopes. d denotes the delta value and</span>
<span class="sd">                                   # c the concentration</span>
<span class="sd">                                   # Use dummy value as necessary.</span>


<span class="sd">         This function can then be used as::</span>

<span class="sd">         GenericFunction(name=&quot;foo&quot;,</span>
<span class="sd">                 function=my_func,</span>
<span class="sd">                 a1 = some argument,</span>
<span class="sd">                 a2 = some argument,</span>
<span class="sd">                 a3 = some argument</span>
<span class="sd">                 a4 = some argument</span>
<span class="sd">                 acton_on = reservoir reference</span>
<span class="sd">                 )</span>

<span class="sd">     see calc_H in the carbonate chemistry module as example</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;function&quot;</span><span class="p">,</span>
        <span class="s2">&quot;act_on&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;i&quot;</span><span class="p">,</span>
        <span class="s2">&quot;act_on&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># list of allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Flux</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="nb">any</span><span class="p">),</span>
            <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># required arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;act_on&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">]</span>

        <span class="c1"># list of default values if none provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lod</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">any</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>  <span class="c1"># default error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="s2">&quot;a reservoir or flux&quot;</span><span class="p">,</span>
                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;a function&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numba List&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;function must be defined before it can be used here&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>  <span class="c1">#</span>

        <span class="c1"># register with reservoir</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">lpc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># register with Reservoir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span><span class="o">.</span><span class="n">lpc_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register with Model</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="p">,</span> <span class="n">Flux</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">lpc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># register with Flux</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span><span class="o">.</span><span class="n">lpc_f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register with Model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;functions can only act upon reservoirs or fluxes&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we execute the user supplied function and assign the</span>
<span class="sd">        return value to the flux or reservoir</span>

<span class="sd">        Where i = index of the current timestep</span>
<span class="sd">              acting_on = reservoir or flux we are acting on.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a4</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">r</span>

    <span class="c1"># redefine post init</span>
    <span class="k">def</span> <span class="nf">__postinit__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Do some housekeeping for the process class&quot;&quot;&quot;</span>

        <span class="c1"># legacy name aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># display name of species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span>  <span class="c1"># the model handle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__misc_init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;return the data associated with this object&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">func_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a4</span><span class="p">,</span>
            <span class="c1"># List(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">l</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="c1"># ),</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This Process class takes a generic function and up to 6 optional
 function arguments, and will replace the mass value(s) of the
 given reservoirs with whatever the function calculates. This is
 particularly useful e.g., to calculate the pH of a given reservoir
 as function of e.g., Alkalinity and DIC.</p>

<p>Parameters:</p>

<ul>
<li>name = name of process,</li>
<li>act_on = name of a reservoir this process will act upon</li>
<li>function  = a function reference</li>
<li>a1 to a3,</li>
</ul>

<p>in order to use this function we need first declare a function we plan to
 use with the generic function process. This function needs to follow the
 below template.</p>

<p>In order to be compatible with the numba solver, a1 and a2 must be
an array of 1-D numpy.arrays i.e., [m, l, h, c]. The array can have
any number of arrays though. a3 must be single array (or list)
containing an arbitrary number of entries. All numbers in a1 to a3
_must_ be of type float64.</p>

<p>The function must return a list of numbers which correspond to the
data which describe a reservoir i.e., mass, light isotope, heavy
isotope, delta, and concentration</p>

<p>In order to use this function we need first declare a function we plan to
use with the generic function process. This function needs to follow this
template::</p>

<pre><code>def my_func(i, a1, a2, a3) -&gt; tuple:
    #
    # i = index of the current timestep
    # a1 to a2 =  optional function parameter. These must be present,
    # even if your function will not use it
    # will be applied to this reservoir.

    # calc some stuff and return it as

    return [m, l, h, d, c] # where m= mass, and l &amp; h are the respective
                           # isotopes. d denotes the delta value and
                           # c the concentration
                           # Use dummy value as necessary.


 This function can then be used as::

 GenericFunction(name="foo",
         function=my_func,
         a1 = some argument,
         a2 = some argument,
         a3 = some argument
         a4 = some argument
         acton_on = reservoir reference
         )
</code></pre>

<p>see calc_H in the carbonate chemistry module as example</p>
</div>


                            <div id="GenericFunction.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GenericFunction.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">GenericFunction</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># list of allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Flux</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="nb">any</span><span class="p">),</span>
            <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># required arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;act_on&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">]</span>

        <span class="c1"># list of default values if none provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lod</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">any</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
            <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span>
            <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">(),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>  <span class="c1"># default error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;act_on&quot;</span><span class="p">:</span> <span class="s2">&quot;a reservoir or flux&quot;</span><span class="p">,</span>
                <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="s2">&quot;a function&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a2&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a3&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numba List&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a4&quot;</span><span class="p">:</span> <span class="s2">&quot;must be a numpy array&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;function must be defined before it can be used here&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>  <span class="c1">#</span>

        <span class="c1"># register with reservoir</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">lpc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># register with Reservoir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span><span class="o">.</span><span class="n">lpc_r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register with Model</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="p">,</span> <span class="n">Flux</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">lpc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># register with Flux</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">mo</span><span class="o">.</span><span class="n">lpc_f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Register with Model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;functions can only act upon reservoirs or fluxes&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Create a new process object with a given process type and options</p>
</div>


                            </div>
                            <div id="GenericFunction.lkk" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.lkk">#&nbsp;&nbsp</a>

        <span class="name">lkk</span><span class="annotation">: Dict[str, &lt;built-in function any&gt;]</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.lrk" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.lrk">#&nbsp;&nbsp</a>

        <span class="name">lrk</span><span class="annotation">: list</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.lod" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.lod">#&nbsp;&nbsp</a>

        <span class="name">lod</span><span class="annotation">: Dict[&lt;built-in function any&gt;, &lt;built-in function any&gt;]</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.get_process_args" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#GenericFunction.get_process_args">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_process_args</span><span class="signature">(self) -&gt; tuple</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;return the data associated with this object&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">func_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a4</span><span class="p">,</span>
            <span class="c1"># List(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">m</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">l</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">h</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">act_on</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="c1"># ),</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>return the data associated with this object</p>
</div>


                            </div>
                            <div id="GenericFunction.a1" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.a1">#&nbsp;&nbsp</a>

        <span class="name">a1</span><span class="default_value"> = &lt;member &#39;a1&#39; of &#39;GenericFunction&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.a2" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.a2">#&nbsp;&nbsp</a>

        <span class="name">a2</span><span class="default_value"> = &lt;member &#39;a2&#39; of &#39;GenericFunction&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.a3" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.a3">#&nbsp;&nbsp</a>

        <span class="name">a3</span><span class="default_value"> = &lt;member &#39;a3&#39; of &#39;GenericFunction&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.a4" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.a4">#&nbsp;&nbsp</a>

        <span class="name">a4</span><span class="default_value"> = &lt;member &#39;a4&#39; of &#39;GenericFunction&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.act_on" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.act_on">#&nbsp;&nbsp</a>

        <span class="name">act_on</span><span class="default_value"> = &lt;member &#39;act_on&#39; of &#39;GenericFunction&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.function" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.function">#&nbsp;&nbsp</a>

        <span class="name">function</span><span class="default_value"> = &lt;member &#39;function&#39; of &#39;GenericFunction&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="GenericFunction.i" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#GenericFunction.i">#&nbsp;&nbsp</a>

        <span class="name">i</span><span class="default_value"> = &lt;member &#39;i&#39; of &#39;GenericFunction&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="GenericFunction.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="GenericFunction.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="GenericFunction.flux" class="variable"><a href="#Process.flux">flux</a></dd>
                <dd id="GenericFunction.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="GenericFunction.r" class="variable"><a href="#Process.r">r</a></dd>
                <dd id="GenericFunction.reservoir" class="variable"><a href="#Process.reservoir">reservoir</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="GenericFunction.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="LookupTable">
                                <div class="attr class">
        <a class="headerlink" href="#LookupTable">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">LookupTable</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">LookupTable</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process replaces the flux-values with values from a static</span>
<span class="sd">    lookup table</span>

<span class="sd">         Example::</span>

<span class="sd">         LookupTable(&quot;name&quot;, upstream_reservoir_handle, lt=flux-object)</span>

<span class="sd">         where the flux-object contains the mass, li, hi, and delta values</span>
<span class="sd">         which will replace the current flux values.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we replace the flux value with the value from the flux object</span>
<span class="sd">        which we use as a lookup-table</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process replaces the flux-values with values from a static
lookup table</p>

<pre><code> Example::

 LookupTable("name", upstream_reservoir_handle, lt=flux-object)

 where the flux-object contains the mass, li, hi, and delta values
 which will replace the current flux values.
</code></pre>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="LookupTable.__init__" class="function"><a href="#Process.__init__">Process</a></dd>
                <dd id="LookupTable.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="LookupTable.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="LookupTable.flux" class="variable"><a href="#Process.flux">flux</a></dd>
                <dd id="LookupTable.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="LookupTable.r" class="variable"><a href="#Process.r">r</a></dd>
                <dd id="LookupTable.reservoir" class="variable"><a href="#Process.reservoir">reservoir</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="LookupTable.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="AddSignal">
                                <div class="attr class">
        <a class="headerlink" href="#AddSignal">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">AddSignal</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">AddSignal</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process adds values to the current flux based on the values provided by the sifnal object.</span>
<span class="sd">    This class is typically invoked through the connector object</span>

<span class="sd">     Example::</span>

<span class="sd">     AddSignal(name = &quot;name&quot;,</span>
<span class="sd">               reservoir = upstream_reservoir_handle,</span>
<span class="sd">               flux = flux_to_act_upon,</span>
<span class="sd">               lt = flux with lookup values)</span>

<span class="sd">     where - the upstream reservoir is the reservoir the process belongs too</span>
<span class="sd">             the flux is the flux to act upon</span>
<span class="sd">             lt= contains the flux object we lookup from</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;lt&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide whichh call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>

    <span class="c1"># setup a placeholder call function</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="c1"># use this when we do isotopes</span>
    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Each process is associated with a flux (self.f). Here we replace</span>
<span class="sd">        the flux value with the value from the signal object which</span>
<span class="sd">        we use as a lookup-table (self.lt)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add signal mass to flux mass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># self.f[i] = self.f[i] + self.lt[i]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_imass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">r</span><span class="o">.</span><span class="n">rvalue</span><span class="p">)</span>
        <span class="c1"># signals may have zero mass, but may have a delta offset. Thus, we do not know</span>
        <span class="c1"># the masses for the light and heavy isotope. As such we have to calculate the masses</span>
        <span class="c1"># after we add the signal to a flux</span>

    <span class="c1"># use this when we do isotopes</span>
    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Each process is associated with a flux (self.f). Here we replace</span>
<span class="sd">        the flux value with the value from the signal object which</span>
<span class="sd">        we use as a lookup-table (self.lt)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add signal mass to flux mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lt</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process adds values to the current flux based on the values provided by the sifnal object.
This class is typically invoked through the connector object</p>

<p>Example::</p>

<p>AddSignal(name = "name",
           reservoir = upstream_reservoir_handle,
           flux = flux_to_act_upon,
           lt = flux with lookup values)</p>

<p>where - the upstream reservoir is the reservoir the process belongs too
         the flux is the flux to act upon
         lt= contains the flux object we lookup from</p>
</div>


                            <div id="AddSignal.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#AddSignal.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">AddSignal</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new process object with a given process type and options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;lt&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide whichh call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>
</pre></div>

        </details>

            <div class="docstring"><p>Create a new process object with a given process type and options</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="AddSignal.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="AddSignal.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="AddSignal.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="AddSignal.flux" class="variable"><a href="#Process.flux">flux</a></dd>
                <dd id="AddSignal.r" class="variable"><a href="#Process.r">r</a></dd>
                <dd id="AddSignal.reservoir" class="variable"><a href="#Process.reservoir">reservoir</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="AddSignal.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PassiveFlux">
                                <div class="attr class">
        <a class="headerlink" href="#PassiveFlux">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">PassiveFlux</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PassiveFlux</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process sets the output flux from a reservoir to be equal to</span>
<span class="sd">    the sum of input fluxes, so that the reservoir concentration does</span>
<span class="sd">    not change. Furthermore, the isotopic ratio of the output flux</span>
<span class="sd">    will be set equal to the isotopic ratio of the reservoir The init</span>
<span class="sd">    and register methods are inherited from the process class. The</span>
<span class="sd">    overall result can be scaled, i.e., in order to create a split flow etc.</span>
<span class="sd">    Example::</span>

<span class="sd">    PassiveFlux(name = &quot;name&quot;,</span>
<span class="sd">                reservoir = upstream_reservoir_handle</span>
<span class="sd">                flux = flux handle)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__misc_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;This is just a place holder method which will be called by default</span>
<span class="sd">        in __post_init__() This can be overloaded to add additional</span>
<span class="sd">        code to the init procedure without the need to redefine</span>
<span class="sd">        init. This useful for processes which only define a call method.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># this process requires delayed init.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span><span class="o">.</span><span class="n">lto</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delayed_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize stuff which is only known after the entire model has been defined.</span>
<span class="sd">        This will be executed just before running the model.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Create a list of fluxes wich excludes the flux this process</span>
        <span class="c1"># will be acting upon</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;delayed init for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fws</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Flux</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">lof</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fws</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># remove this handle</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we re-balance the flux. That is, we calculate the sum of all fluxes</span>
<span class="sd">        excluding this flux. This sum will be equal to this flux. This will likely only</span>
<span class="sd">        work for outfluxes though.</span>

<span class="sd">        Should this be done for output fluxes as well?</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># calc sum of fluxes in fws. Note that at this point, not all fluxes</span>
        <span class="c1"># will be known so we need to use the flux values from the previous times-step</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fws</span><span class="p">):</span>
            <span class="c1"># print(f&quot;{f.n} = {f.m[i-1] * reservoir.lio[f]}&quot;)</span>
            <span class="n">new</span> <span class="o">+=</span> <span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">lio</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>

        <span class="c1"># print(f&quot;sum = {new:.0f}\n&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_flux_data</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">rvalue</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process sets the output flux from a reservoir to be equal to
the sum of input fluxes, so that the reservoir concentration does
not change. Furthermore, the isotopic ratio of the output flux
will be set equal to the isotopic ratio of the reservoir The init
and register methods are inherited from the process class. The
overall result can be scaled, i.e., in order to create a split flow etc.
Example::</p>

<p>PassiveFlux(name = "name",
            reservoir = upstream_reservoir_handle
            flux = flux handle)</p>
</div>


                            <div id="PassiveFlux.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#PassiveFlux.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">PassiveFlux</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Initialize this Process</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="PassiveFlux.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="PassiveFlux.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="PassiveFlux.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="PassiveFlux.flux" class="variable"><a href="#Process.flux">flux</a></dd>
                <dd id="PassiveFlux.r" class="variable"><a href="#Process.r">r</a></dd>
                <dd id="PassiveFlux.reservoir" class="variable"><a href="#Process.reservoir">reservoir</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="PassiveFlux.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PassiveFlux_fixed_delta">
                                <div class="attr class">
        <a class="headerlink" href="#PassiveFlux_fixed_delta">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">PassiveFlux_fixed_delta</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PassiveFlux_fixed_delta</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process sets the output flux from a reservoir to be equal to</span>
<span class="sd">    the sum of input fluxes, so that the reservoir concentration does</span>
<span class="sd">    not change. However, the isotopic ratio of the output flux is set</span>
<span class="sd">    at a fixed value. The init and register methods are inherited</span>
<span class="sd">    from the process class. The overall result can be scaled, i.e.,</span>
<span class="sd">    in order to create a split flow etc.  Example::</span>

<span class="sd">    PassiveFlux_fixed_delta(name = &quot;name&quot;,</span>
<span class="sd">                            reservoir = upstream_reservoir_handle,</span>
<span class="sd">                            flux handle,</span>
<span class="sd">                            delta = delta offset)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># legacy names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">n *** Warning, you selected the PassiveFlux_fixed_delta method ***</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot; This is not a particularly phyiscal process is this really what you want?</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we re-balance the flux. This code will be called by the</span>
<span class="sd">        apply_flux_modifier method of a reservoir which itself is</span>
<span class="sd">        called by the model execute method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">rvalue</span>  <span class="c1"># the isotope reference value</span>

        <span class="n">varflux</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span>
        <span class="n">flux_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Flux</span><span class="p">]</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">lof</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">flux_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">varflux</span><span class="p">)</span>  <span class="c1"># remove this handle</span>

        <span class="c1"># sum up the remaining fluxes</span>
        <span class="n">newflux</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flux_list</span><span class="p">:</span>
            <span class="n">newflux</span> <span class="o">=</span> <span class="n">newflux</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">lio</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>

        <span class="c1"># set isotope mass according to keyword value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">get_flux_data</span><span class="p">(</span><span class="n">newflux</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process sets the output flux from a reservoir to be equal to
the sum of input fluxes, so that the reservoir concentration does
not change. However, the isotopic ratio of the output flux is set
at a fixed value. The init and register methods are inherited
from the process class. The overall result can be scaled, i.e.,
in order to create a split flow etc.  Example::</p>

<p>PassiveFlux_fixed_delta(name = "name",
                        reservoir = upstream_reservoir_handle,
                        flux handle,
                        delta = delta offset)</p>
</div>


                            <div id="PassiveFlux_fixed_delta.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#PassiveFlux_fixed_delta.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">PassiveFlux_fixed_delta</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="c1"># self.bem.update({&quot;rate&quot;: &quot;a string&quot;})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># legacy names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">:</span> <span class="n">Flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">n *** Warning, you selected the PassiveFlux_fixed_delta method ***</span><span class="se">\n</span><span class="s2"> &quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot; This is not a particularly phyiscal process is this really what you want?</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Initialize this Process</p>
</div>


                            </div>
                            <div id="PassiveFlux_fixed_delta.f" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#PassiveFlux_fixed_delta.f">#&nbsp;&nbsp</a>

        <span class="name">f</span><span class="annotation">: <a href="esbmtk.html#Flux">esbmtk.esbmtk.Flux</a></span>
    </div>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="PassiveFlux_fixed_delta.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="PassiveFlux_fixed_delta.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="PassiveFlux_fixed_delta.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="PassiveFlux_fixed_delta.flux" class="variable"><a href="#Process.flux">flux</a></dd>
                <dd id="PassiveFlux_fixed_delta.r" class="variable"><a href="#Process.r">r</a></dd>
                <dd id="PassiveFlux_fixed_delta.reservoir" class="variable"><a href="#Process.reservoir">reservoir</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="PassiveFlux_fixed_delta.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="VarDeltaOut">
                                <div class="attr class">
        <a class="headerlink" href="#VarDeltaOut">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">VarDeltaOut</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">VarDeltaOut</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Unlike a passive flux, this process sets the flux istope ratio</span>
<span class="sd">    equal to the isotopic ratio of the reservoir. The</span>
<span class="sd">    init and register methods are inherited from the process</span>
<span class="sd">    class.</span>

<span class="sd">    VarDeltaOut(name = &quot;name&quot;,</span>
<span class="sd">                reservoir = upstream_reservoir_handle,</span>
<span class="sd">                flux = flux handle,</span>
<span class="sd">                rate = rate,)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">ConnectionGroup</span>
        <span class="kn">from</span> <span class="nn">esbmtk</span> <span class="kn">import</span> <span class="n">Flux</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">ReservoirGroup</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Q_</span><span class="p">),</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">ConnectionGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Flux</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="c1"># print(</span>
            <span class="c1">#    f&quot;vardeltaout with isotopes for {self.reservoir.register.name}.{self.reservoir.name}&quot;</span>
            <span class="c1"># )</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">):</span>
                <span class="c1"># print(&quot;Using reservoir&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes_reservoir__</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
                <span class="c1"># print(&quot;Using Source&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes_source__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, reservoir must be of type Source or Reservoir, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>

    <span class="c1"># setup a placeholder call function</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span><span class="p">(</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__with_isotopes_reservoir__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we re-balance the flux. This code will be called by the</span>
<span class="sd">        apply_flux_modifier method of a reservoir which itself is</span>
<span class="sd">        called by the model execute method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># if reservoir.register.name == &quot;db&quot;:</span>
            <span class="c1">#    print(f&quot;{reservoir.name} d={reservoir.d[i-1]}&quot;)</span>
            <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
            <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
            <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="c1"># if upstream is a source, we only have a single delta value</span>
        <span class="c1"># so we need to patch this. Maybe this should move to source?</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_vardeltaout</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)])</span>

        <span class="c1"># print(f&quot;rd = {res_data[2][0]}, fd = {flux_data[0][0]}&quot;)</span>
        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_vardeltaout</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="c1"># res_data[0] is actually flux data. See get_process args for details</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># r mass</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">__with_isotopes_source__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;If the source of the flux is a source, there is only a single delta value.</span>
<span class="sd">        Changes to the flux delta are applied through the Signal class.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">delta</span>
            <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
            <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
            <span class="n">h</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Here we re-balance the flux. This code will be called by the</span>
<span class="sd">        apply_flux_modifier method of a reservoir which itself is</span>
<span class="sd">        called by the model execute method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>Unlike a passive flux, this process sets the flux istope ratio
equal to the isotopic ratio of the reservoir. The
init and register methods are inherited from the process
class.</p>

<p>VarDeltaOut(name = "name",
            reservoir = upstream_reservoir_handle,
            flux = flux handle,
            rate = rate,)</p>
</div>


                            <div id="VarDeltaOut.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#VarDeltaOut.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">VarDeltaOut</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">ConnectionGroup</span>
        <span class="kn">from</span> <span class="nn">esbmtk</span> <span class="kn">import</span> <span class="n">Flux</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">ReservoirGroup</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;rate&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Q_</span><span class="p">),</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">ConnectionGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Flux</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="c1"># print(</span>
            <span class="c1">#    f&quot;vardeltaout with isotopes for {self.reservoir.register.name}.{self.reservoir.name}&quot;</span>
            <span class="c1"># )</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">):</span>
                <span class="c1"># print(&quot;Using reservoir&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes_reservoir__</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
                <span class="c1"># print(&quot;Using Source&quot;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes_source__</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, reservoir must be of type Source or Reservoir, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>
</pre></div>

        </details>

            <div class="docstring"><p>Initialize this Process</p>
</div>


                            </div>
                            <div id="VarDeltaOut.lkk" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#VarDeltaOut.lkk">#&nbsp;&nbsp</a>

        <span class="name">lkk</span><span class="annotation">: Dict[str, &lt;built-in function any&gt;]</span>
    </div>

    

                            </div>
                            <div id="VarDeltaOut.get_process_args" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#VarDeltaOut.get_process_args">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_process_args</span><span class="signature">(self, reservoir: <a href="esbmtk.html#Reservoir">esbmtk.esbmtk.Reservoir</a>)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="c1"># if upstream is a source, we only have a single delta value</span>
        <span class="c1"># so we need to patch this. Maybe this should move to source?</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_vardeltaout</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">)])</span>

        <span class="c1"># print(f&quot;rd = {res_data[2][0]}, fd = {flux_data[0][0]}&quot;)</span>
        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="VarDeltaOut.p_vardeltaout" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#VarDeltaOut.p_vardeltaout">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>
        <div class="decorator">@njit()</div>

            <span class="def">def</span>
            <span class="name">p_vardeltaout</span><span class="signature">(res_data, flux_data, proc_const, i) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_vardeltaout</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="c1"># res_data[0] is actually flux data. See get_process args for details</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># r mass</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="VarDeltaOut.flux" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#VarDeltaOut.flux">#&nbsp;&nbsp</a>

        <span class="name">flux</span><span class="default_value"> = &lt;member &#39;flux&#39; of &#39;VarDeltaOut&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="VarDeltaOut.rate" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#VarDeltaOut.rate">#&nbsp;&nbsp</a>

        <span class="name">rate</span><span class="default_value"> = &lt;member &#39;rate&#39; of &#39;VarDeltaOut&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="VarDeltaOut.reservoir" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#VarDeltaOut.reservoir">#&nbsp;&nbsp</a>

        <span class="name">reservoir</span><span class="default_value"> = &lt;member &#39;reservoir&#39; of &#39;VarDeltaOut&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="VarDeltaOut.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="VarDeltaOut.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="VarDeltaOut.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="VarDeltaOut.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="VarDeltaOut.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ScaleFlux">
                                <div class="attr class">
        <a class="headerlink" href="#ScaleFlux">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">ScaleFlux</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ScaleFlux</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process scales the mass of a flux (m,l,h) relative to another</span>
<span class="sd">    flux but does not affect delta. The scale factor &quot;scale&quot; and flux</span>
<span class="sd">    reference must be present when the object is being initalized</span>

<span class="sd">    Example::</span>
<span class="sd">         ScaleFlux(name = &quot;Name&quot;,</span>
<span class="sd">                   reservoir = reservoir_handle (upstream or downstream)</span>
<span class="sd">                   scale = 1</span>
<span class="sd">                   ref_reservoirs = flux we use for scale)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;rate&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>

    <span class="c1"># setup a placeholder call function</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span><span class="p">(</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the scale factor. This is typically done through the the</span>
<span class="sd">        model execute method.</span>
<span class="sd">        Note that this will use the mass of the reference object, but that we will set the</span>
<span class="sd">        delta according to the reservoir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the scale factor. This is typically done through the the</span>
<span class="sd">        model execute method.</span>
<span class="sd">        Note that this will use the mass of the reference object, but that we will set the</span>
<span class="sd">        delta according to the reservoir (or the flux?)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_flux</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="o">.</span><span class="n">m</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_flux</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="c1"># print(f&quot;ScaleFlux m = {m:.2e}, scale = {proc_const[1]}&quot;)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process scales the mass of a flux (m,l,h) relative to another
flux but does not affect delta. The scale factor "scale" and flux
reference must be present when the object is being initalized</p>

<p>Example::
     ScaleFlux(name = "Name",
               reservoir = reservoir_handle (upstream or downstream)
               scale = 1
               ref_reservoirs = flux we use for scale)</p>
</div>


                            <div id="ScaleFlux.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ScaleFlux.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">ScaleFlux</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>
</pre></div>

        </details>

            <div class="docstring"><p>Initialize this Process</p>
</div>


                            </div>
                            <div id="ScaleFlux.get_process_args" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ScaleFlux.get_process_args">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_process_args</span><span class="signature">(self, reservoir: <a href="esbmtk.html#Reservoir">esbmtk.esbmtk.Reservoir</a>)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_flux</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="o">.</span><span class="n">m</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="ScaleFlux.p_scale_flux" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ScaleFlux.p_scale_flux">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>
        <div class="decorator">@njit()</div>

            <span class="def">def</span>
            <span class="name">p_scale_flux</span><span class="signature">(res_data, flux_data, proc_const, i) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_flux</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="c1"># print(f&quot;ScaleFlux m = {m:.2e}, scale = {proc_const[1]}&quot;)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="ScaleFlux.flux" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#ScaleFlux.flux">#&nbsp;&nbsp</a>

        <span class="name">flux</span><span class="default_value"> = &lt;member &#39;flux&#39; of &#39;ScaleFlux&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="ScaleFlux.rate" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#ScaleFlux.rate">#&nbsp;&nbsp</a>

        <span class="name">rate</span><span class="default_value"> = &lt;member &#39;rate&#39; of &#39;ScaleFlux&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="ScaleFlux.ref_reservoirs" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#ScaleFlux.ref_reservoirs">#&nbsp;&nbsp</a>

        <span class="name">ref_reservoirs</span><span class="default_value"> = &lt;member &#39;ref_reservoirs&#39; of &#39;ScaleFlux&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="ScaleFlux.reservoir" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#ScaleFlux.reservoir">#&nbsp;&nbsp</a>

        <span class="name">reservoir</span><span class="default_value"> = &lt;member &#39;reservoir&#39; of &#39;ScaleFlux&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="ScaleFlux.scale" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#ScaleFlux.scale">#&nbsp;&nbsp</a>

        <span class="name">scale</span><span class="default_value"> = &lt;member &#39;scale&#39; of &#39;ScaleFlux&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="ScaleFlux.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="ScaleFlux.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="ScaleFlux.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="ScaleFlux.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="ScaleFlux.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Reaction">
                                <div class="attr class">
        <a class="headerlink" href="#Reaction">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Reaction</span>(<span class="base"><a href="#ScaleFlux">ScaleFlux</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Reaction</span><span class="p">(</span><span class="n">ScaleFlux</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process approximates the effect of a chemical reaction between</span>
<span class="sd">    two fluxes which belong to a differents species (e.g., S, and O).</span>
<span class="sd">    The flux belonging to the upstream reservoir will simply be</span>
<span class="sd">    scaled relative to the flux it reacts with. The scaling is given</span>
<span class="sd">    by the ratio argument. So this function is equivalent to the</span>
<span class="sd">    ScaleFlux class.</span>

<span class="sd">    Example::</span>

<span class="sd">       Connect(source=IW_H2S,</span>
<span class="sd">               sink=S0,</span>
<span class="sd">               ctype = &quot;react_with&quot;,</span>
<span class="sd">               scale=1,</span>
<span class="sd">               ref_reservoirs = O2_diff_to_S0,</span>
<span class="sd">               scale =1,</span>
<span class="sd">       )</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process approximates the effect of a chemical reaction between
two fluxes which belong to a differents species (e.g., S, and O).
The flux belonging to the upstream reservoir will simply be
scaled relative to the flux it reacts with. The scaling is given
by the ratio argument. So this function is equivalent to the
ScaleFlux class.</p>

<p>Example::</p>

<p>Connect(source=IW_H2S,
           sink=S0,
           ctype = "react_with",
           scale=1,
           ref_reservoirs = O2_diff_to_S0,
           scale =1,
   )</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ScaleFlux">ScaleFlux</a></dt>
                                <dd id="Reaction.__init__" class="function"><a href="#ScaleFlux.__init__">ScaleFlux</a></dd>
                <dd id="Reaction.get_process_args" class="function"><a href="#ScaleFlux.get_process_args">get_process_args</a></dd>
                <dd id="Reaction.p_scale_flux" class="function"><a href="#ScaleFlux.p_scale_flux">p_scale_flux</a></dd>
                <dd id="Reaction.flux" class="variable"><a href="#ScaleFlux.flux">flux</a></dd>
                <dd id="Reaction.rate" class="variable"><a href="#ScaleFlux.rate">rate</a></dd>
                <dd id="Reaction.ref_reservoirs" class="variable"><a href="#ScaleFlux.ref_reservoirs">ref_reservoirs</a></dd>
                <dd id="Reaction.reservoir" class="variable"><a href="#ScaleFlux.reservoir">reservoir</a></dd>
                <dd id="Reaction.scale" class="variable"><a href="#ScaleFlux.scale">scale</a></dd>

            </div>
            <div><dt><a href="#Process">Process</a></dt>
                                <dd id="Reaction.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="Reaction.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="Reaction.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="Reaction.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="Reaction.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="FluxDiff">
                                <div class="attr class">
        <a class="headerlink" href="#FluxDiff">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">FluxDiff</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">FluxDiff</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The new flux will be the difference of two fluxes&quot;&quot;&quot;</span>

    <span class="sd">&quot;&quot;&quot;This process scales the mass of a flux (m,l,h) relative to another</span>
<span class="sd">     flux but does not affect delta. The scale factor &quot;scale&quot; and flux</span>
<span class="sd">     reference must be present when the object is being initalized</span>

<span class="sd">     Example::</span>
<span class="sd">          ScaleFlux(name = &quot;Name&quot;,</span>
<span class="sd">                    reservoir = upstream_reservoir_handle,</span>
<span class="sd">                    scale = 1</span>
<span class="sd">                    ref_reservoirs = flux we use for scale)</span>

<span class="sd">     &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Apply the scale factor. This is typically done through the the</span>
<span class="sd">        model execute method.</span>
<span class="sd">        Note that this will use the mass of the reference object, but that we will set the</span>
<span class="sd">        delta according to the reservoir (or the flux?)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
</pre></div>

        </details>

            <div class="docstring"><p>The new flux will be the difference of two fluxes</p>
</div>


                            <div id="FluxDiff.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#FluxDiff.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">FluxDiff</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Initialize this Process</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="FluxDiff.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="FluxDiff.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="FluxDiff.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="FluxDiff.flux" class="variable"><a href="#Process.flux">flux</a></dd>
                <dd id="FluxDiff.r" class="variable"><a href="#Process.r">r</a></dd>
                <dd id="FluxDiff.reservoir" class="variable"><a href="#Process.reservoir">reservoir</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="FluxDiff.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Fractionation">
                                <div class="attr class">
        <a class="headerlink" href="#Fractionation">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Fractionation</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Fractionation</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process offsets the isotopic ratio of the flux by a given</span>
<span class="sd">       delta value. In other words, we add a fractionation factor</span>

<span class="sd">    Example::</span>
<span class="sd">         Fractionation(name = &quot;Name&quot;,</span>
<span class="sd">                       reservoir = upstream_reservoir_handle,</span>
<span class="sd">                       flux = flux handle</span>
<span class="sd">                       alpha = 12 in permil (e.f)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># alpha is given in permil, but the fractionation routine expects</span>
        <span class="c1"># it as 1 + permil, i.e., 70 permil would 1.007</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set flux isotope masses based on fractionation factor</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(f&quot;delta before = {get_delta(self.f.l[i], self.f.h[i], self.f.rvalue)}&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_frac</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">alp</span><span class="p">)</span>
            <span class="c1"># update delta</span>
            <span class="c1"># self.f.d[i] = get_delta(self.f.l[i], self.f.h[i], self.f.rvalue)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
            <span class="c1"># print(f&quot;delta after = {get_delta(self.f.l[i], self.f.h[i], self.f.rvalue)}\n&quot;)</span>

        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_fractionation</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_fractionation</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process offsets the isotopic ratio of the flux by a given
   delta value. In other words, we add a fractionation factor</p>

<p>Example::
     Fractionation(name = "Name",
                   reservoir = upstream_reservoir_handle,
                   flux = flux handle
                   alpha = 12 in permil (e.f)</p>
</div>


                            <div id="Fractionation.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Fractionation.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Fractionation</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">])</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>

        <span class="c1"># alpha is given in permil, but the fractionation routine expects</span>
        <span class="c1"># it as 1 + permil, i.e., 70 permil would 1.007</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Initialize this Process</p>
</div>


                            </div>
                            <div id="Fractionation.get_process_args" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Fractionation.get_process_args">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_process_args</span><span class="signature">(self, reservoir: <a href="esbmtk.html#Reservoir">esbmtk.esbmtk.Reservoir</a>)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_fractionation</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Fractionation.p_fractionation" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Fractionation.p_fractionation">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>
        <div class="decorator">@njit()</div>

            <span class="def">def</span>
            <span class="name">p_fractionation</span><span class="signature">(res_data, flux_data, proc_const, i) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_fractionation</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>

        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Fractionation.flux" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Fractionation.flux">#&nbsp;&nbsp</a>

        <span class="name">flux</span><span class="default_value"> = &lt;member &#39;flux&#39; of &#39;Fractionation&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="Fractionation.reservoir" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Fractionation.reservoir">#&nbsp;&nbsp</a>

        <span class="name">reservoir</span><span class="default_value"> = &lt;member &#39;reservoir&#39; of &#39;Fractionation&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="Fractionation.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="Fractionation.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="Fractionation.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="Fractionation.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="Fractionation.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="RateConstant">
                                <div class="attr class">
        <a class="headerlink" href="#RateConstant">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">RateConstant</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">RateConstant</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is a wrapper for a variety of processes which depend on rate constants</span>
<span class="sd">    Please see the below class definitions for details on how to call them</span>
<span class="sd">    At present, the following processes are defined</span>

<span class="sd">    ScaleRelativeToNormalizedConcentration</span>
<span class="sd">    ScaleRelativeToConcentration</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_value&quot;</span><span class="p">,</span> <span class="s2">&quot;k_value&quot;</span><span class="p">,</span> <span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="s2">&quot;reservoir&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">SourceGroup</span><span class="p">,</span> <span class="n">SinkGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">ConnectionGroup</span>
        <span class="kn">from</span> <span class="nn">esbmtk</span> <span class="kn">import</span> <span class="n">Flux</span>

        <span class="c1"># Note that self.lkk values also need to be added to the lkk</span>
        <span class="c1"># list of the connector object.</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># update the allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;k_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">),</span>
            <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">),</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">SourceGroup</span><span class="p">,</span>
                <span class="n">SinkGroup</span><span class="p">,</span>
                <span class="n">ReservoirGroup</span><span class="p">,</span>
                <span class="n">ConnectionGroup</span><span class="p">,</span>
                <span class="n">Flux</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;k_value&quot;</span><span class="p">]])</span>

        <span class="c1"># dict with default values if none provided</span>
        <span class="c1"># self.lod = {r</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>

        <span class="c1"># add these terms to the known error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="s2">&quot;Reservoir handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">:</span> <span class="s2">&quot;List of Reservoir handle(s)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number or flux quantity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;a string value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="s2">&quot;a flux handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;list, reservoir or number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s2">&quot;list, reservoir or number&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># xxx if self.register != &quot;None&quot;:</span>
        <span class="c1">#    self.name = f&quot;{self.register}.{self.name}&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>

    <span class="c1"># setup a placeholder call function</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span><span class="p">(</span><span class="n">reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This is a wrapper for a variety of processes which depend on rate constants
Please see the below class definitions for details on how to call them
At present, the following processes are defined</p>

<p>ScaleRelativeToNormalizedConcentration
ScaleRelativeToConcentration</p>
</div>


                            <div id="RateConstant.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#RateConstant.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">RateConstant</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Initialize this Process&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">SourceGroup</span><span class="p">,</span> <span class="n">SinkGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span>
        <span class="kn">from</span> <span class="nn">.connections</span> <span class="kn">import</span> <span class="n">ConnectionGroup</span>
        <span class="kn">from</span> <span class="nn">esbmtk</span> <span class="kn">import</span> <span class="n">Flux</span>

        <span class="c1"># Note that self.lkk values also need to be added to the lkk</span>
        <span class="c1"># list of the connector object.</span>

        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># update the allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;k_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">),</span>
            <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">),</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">SourceGroup</span><span class="p">,</span>
                <span class="n">SinkGroup</span><span class="p">,</span>
                <span class="n">ReservoirGroup</span><span class="p">,</span>
                <span class="n">ConnectionGroup</span><span class="p">,</span>
                <span class="n">Flux</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># new required keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;k_value&quot;</span><span class="p">]])</span>

        <span class="c1"># dict with default values if none provided</span>
        <span class="c1"># self.lod = {r</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>

        <span class="c1"># add these terms to the known error messages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;scale&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="s2">&quot;Reservoir handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_reservoirs&quot;</span><span class="p">:</span> <span class="s2">&quot;List of Reservoir handle(s)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number or flux quantity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;a string value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="s2">&quot;a flux handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;list, reservoir or number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s2">&quot;list, reservoir or number&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># xxx if self.register != &quot;None&quot;:</span>
        <span class="c1">#    self.name = f&quot;{self.register}.{self.name}&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

        <span class="c1"># decide which call function to use</span>
        <span class="c1"># if self.mo.m_type == &quot;both&quot;:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">isotopes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__with_isotopes__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__execute__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__without_isotopes__</span>
</pre></div>

        </details>

            <div class="docstring"><p>Initialize this Process</p>
</div>


                            </div>
                            <div id="RateConstant.lkk" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#RateConstant.lkk">#&nbsp;&nbsp</a>

        <span class="name">lkk</span><span class="annotation">: dict</span>
    </div>

    

                            </div>
                            <div id="RateConstant.flux" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#RateConstant.flux">#&nbsp;&nbsp</a>

        <span class="name">flux</span><span class="default_value"> = &lt;member &#39;flux&#39; of &#39;RateConstant&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="RateConstant.k_value" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#RateConstant.k_value">#&nbsp;&nbsp</a>

        <span class="name">k_value</span><span class="default_value"> = &lt;member &#39;k_value&#39; of &#39;RateConstant&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="RateConstant.ref_value" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#RateConstant.ref_value">#&nbsp;&nbsp</a>

        <span class="name">ref_value</span><span class="default_value"> = &lt;member &#39;ref_value&#39; of &#39;RateConstant&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="RateConstant.reservoir" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#RateConstant.reservoir">#&nbsp;&nbsp</a>

        <span class="name">reservoir</span><span class="default_value"> = &lt;member &#39;reservoir&#39; of &#39;RateConstant&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div id="RateConstant.scale" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#RateConstant.scale">#&nbsp;&nbsp</a>

        <span class="name">scale</span><span class="default_value"> = &lt;member &#39;scale&#39; of &#39;RateConstant&#39; objects&gt;</span>
    </div>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="RateConstant.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="RateConstant.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="RateConstant.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="RateConstant.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="RateConstant.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ScaleRelativeToConcentration">
                                <div class="attr class">
        <a class="headerlink" href="#ScaleRelativeToConcentration">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">ScaleRelativeToConcentration</span>(<span class="base"><a href="#RateConstant">RateConstant</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ScaleRelativeToConcentration</span><span class="p">(</span><span class="n">RateConstant</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process calculates the flux as a function of the upstream</span>
<span class="sd">     reservoir concentration C and a constant which describes thet</span>
<span class="sd">     strength of relation between the reservoir concentration and</span>
<span class="sd">     the flux scaling</span>

<span class="sd">     F = C * k</span>

<span class="sd">     where C denotes the concentration in the ustream reservoir, k is a</span>
<span class="sd">     constant. This process is typically called by the connector</span>
<span class="sd">     instance. However you can instantiate it manually as</span>

<span class="sd">     ScaleRelativeToConcentration(</span>
<span class="sd">                       name = &quot;Name&quot;,</span>
<span class="sd">                       reservoir= upstream_reservoir_handle,</span>
<span class="sd">                       flux = flux handle,</span>
<span class="sd">                       Scale =  1000,</span>
<span class="sd">    )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># otherwise there is no flux</span>
            <span class="c1"># convert to concentration</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">volume</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        C = M/V so we express this as relative to mass which allows us to</span>
<span class="sd">        use the isotope data.</span>

<span class="sd">        The below calculates the flux as function of reservoir concentration,</span>
<span class="sd">        rather than scaling the flux.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># otherwise there is no flux</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
            <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
            <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_relative_to_concentration</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_relative_to_concentration</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process calculates the flux as a function of the upstream
 reservoir concentration C and a constant which describes thet
 strength of relation between the reservoir concentration and
 the flux scaling</p>

<p>F = C * k</p>

<p>where C denotes the concentration in the ustream reservoir, k is a
 constant. This process is typically called by the connector
 instance. However you can instantiate it manually as</p>

<p>ScaleRelativeToConcentration(
                   name = "Name",
                   reservoir= upstream_reservoir_handle,
                   flux = flux handle,
                   Scale =  1000,
)</p>
</div>


                            <div id="ScaleRelativeToConcentration.get_process_args" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ScaleRelativeToConcentration.get_process_args">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_process_args</span><span class="signature">(self, reservoir: <a href="esbmtk.html#Reservoir">esbmtk.esbmtk.Reservoir</a>)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_relative_to_concentration</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="ScaleRelativeToConcentration.p_scale_relative_to_concentration" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ScaleRelativeToConcentration.p_scale_relative_to_concentration">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>
        <div class="decorator">@njit()</div>

            <span class="def">def</span>
            <span class="name">p_scale_relative_to_concentration</span><span class="signature">(res_data, flux_data, proc_const, i) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_relative_to_concentration</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#RateConstant">RateConstant</a></dt>
                                <dd id="ScaleRelativeToConcentration.__init__" class="function"><a href="#RateConstant.__init__">RateConstant</a></dd>
                <dd id="ScaleRelativeToConcentration.lkk" class="variable"><a href="#RateConstant.lkk">lkk</a></dd>
                <dd id="ScaleRelativeToConcentration.flux" class="variable"><a href="#RateConstant.flux">flux</a></dd>
                <dd id="ScaleRelativeToConcentration.k_value" class="variable"><a href="#RateConstant.k_value">k_value</a></dd>
                <dd id="ScaleRelativeToConcentration.ref_value" class="variable"><a href="#RateConstant.ref_value">ref_value</a></dd>
                <dd id="ScaleRelativeToConcentration.reservoir" class="variable"><a href="#RateConstant.reservoir">reservoir</a></dd>
                <dd id="ScaleRelativeToConcentration.scale" class="variable"><a href="#RateConstant.scale">scale</a></dd>

            </div>
            <div><dt><a href="#Process">Process</a></dt>
                                <dd id="ScaleRelativeToConcentration.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="ScaleRelativeToConcentration.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="ScaleRelativeToConcentration.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="ScaleRelativeToConcentration.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="ScaleRelativeToConcentration.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ScaleRelativeToMass">
                                <div class="attr class">
        <a class="headerlink" href="#ScaleRelativeToMass">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">ScaleRelativeToMass</span>(<span class="base"><a href="#RateConstant">RateConstant</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ScaleRelativeToMass</span><span class="p">(</span><span class="n">RateConstant</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process scales the flux as a function of the upstream</span>
<span class="sd">     reservoir Mass M and a constant which describes the</span>
<span class="sd">     strength of relation between the reservoir mass and</span>
<span class="sd">     the flux scaling</span>

<span class="sd">     F = F0 *  M * k</span>

<span class="sd">     where M denotes the mass in the ustream reservoir, k is a</span>
<span class="sd">     constant and F0 is the initial unscaled flux. This process is</span>
<span class="sd">     typically called by the connector instance. However you can</span>
<span class="sd">     instantiate it manually as</span>

<span class="sd">     Note that we scale the flux, rather than compute the flux!</span>

<span class="sd">     This is faster than setting a new flux, computing the isotope</span>
<span class="sd">     ratio and setting delta. So you either have to set the initial</span>
<span class="sd">     flux F0 to 1, or calculate the scale accordingly</span>

<span class="sd">     ScaleRelativeToMass(</span>
<span class="sd">                       name = &quot;Name&quot;,</span>
<span class="sd">                       reservoir= upstream_reservoir_handle,</span>
<span class="sd">                       flux = flux handle,</span>
<span class="sd">                       Scale =  1000,</span>
<span class="sd">    )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">m</span>

    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this will be called by the Model.run() method</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span>
        <span class="n">r</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the data associated with this object&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_relative_to_mass</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_relative_to_mass</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process scales the flux as a function of the upstream
 reservoir Mass M and a constant which describes the
 strength of relation between the reservoir mass and
 the flux scaling</p>

<p>F = F0 *  M * k</p>

<p>where M denotes the mass in the ustream reservoir, k is a
 constant and F0 is the initial unscaled flux. This process is
 typically called by the connector instance. However you can
 instantiate it manually as</p>

<p>Note that we scale the flux, rather than compute the flux!</p>

<p>This is faster than setting a new flux, computing the isotope
 ratio and setting delta. So you either have to set the initial
 flux F0 to 1, or calculate the scale accordingly</p>

<p>ScaleRelativeToMass(
                   name = "Name",
                   reservoir= upstream_reservoir_handle,
                   flux = flux handle,
                   Scale =  1000,
)</p>
</div>


                            <div id="ScaleRelativeToMass.get_process_args" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ScaleRelativeToMass.get_process_args">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">get_process_args</span><span class="signature">(self, reservoir: <a href="esbmtk.html#Reservoir">esbmtk.esbmtk.Reservoir</a>)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">get_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the data associated with this object&quot;&quot;&quot;</span>

        <span class="n">func_name</span><span class="p">:</span> <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_scale_relative_to_mass</span>

        <span class="n">res_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">])</span>
        <span class="n">flux_data</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">d</span><span class="p">])</span>
        <span class="n">proc_const</span> <span class="o">=</span> <span class="n">List</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">reservoir</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">r</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span>
</pre></div>

        </details>

            <div class="docstring"><p>return the data associated with this object</p>
</div>


                            </div>
                            <div id="ScaleRelativeToMass.p_scale_relative_to_mass" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#ScaleRelativeToMass.p_scale_relative_to_mass">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>
        <div class="decorator">@njit()</div>

            <span class="def">def</span>
            <span class="name">p_scale_relative_to_mass</span><span class="signature">(res_data, flux_data, proc_const, i) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="nd">@njit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">p_scale_relative_to_mass</span><span class="p">(</span><span class="n">res_data</span><span class="p">,</span> <span class="n">flux_data</span><span class="p">,</span> <span class="n">proc_const</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># concentration times scale factor</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">res_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># delta</span>
        <span class="n">l</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">proc_const</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">l</span>
        <span class="n">flux_data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
</pre></div>

        </details>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#RateConstant">RateConstant</a></dt>
                                <dd id="ScaleRelativeToMass.__init__" class="function"><a href="#RateConstant.__init__">RateConstant</a></dd>
                <dd id="ScaleRelativeToMass.lkk" class="variable"><a href="#RateConstant.lkk">lkk</a></dd>
                <dd id="ScaleRelativeToMass.flux" class="variable"><a href="#RateConstant.flux">flux</a></dd>
                <dd id="ScaleRelativeToMass.k_value" class="variable"><a href="#RateConstant.k_value">k_value</a></dd>
                <dd id="ScaleRelativeToMass.ref_value" class="variable"><a href="#RateConstant.ref_value">ref_value</a></dd>
                <dd id="ScaleRelativeToMass.reservoir" class="variable"><a href="#RateConstant.reservoir">reservoir</a></dd>
                <dd id="ScaleRelativeToMass.scale" class="variable"><a href="#RateConstant.scale">scale</a></dd>

            </div>
            <div><dt><a href="#Process">Process</a></dt>
                                <dd id="ScaleRelativeToMass.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="ScaleRelativeToMass.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="ScaleRelativeToMass.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="ScaleRelativeToMass.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="ScaleRelativeToMass.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ScaleRelative2otherReservoir">
                                <div class="attr class">
        <a class="headerlink" href="#ScaleRelative2otherReservoir">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">ScaleRelative2otherReservoir</span>(<span class="base"><a href="#RateConstant">RateConstant</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">ScaleRelative2otherReservoir</span><span class="p">(</span><span class="n">RateConstant</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process scales the flux as a function one or more reservoirs</span>
<span class="sd">    constant which describes the</span>
<span class="sd">    strength of relation between the reservoir concentration and</span>
<span class="sd">    the flux scaling</span>

<span class="sd">    F = C1 * C1 * k</span>

<span class="sd">    where Mi denotes the concentration in one  or more reservoirs, k is one</span>
<span class="sd">    or more constant(s). This process is typically called by the connector</span>
<span class="sd">    instance when you specify the connection as</span>

<span class="sd">    Connect(source =  upstream reservoir,</span>
<span class="sd">              sink = downstream reservoir,</span>
<span class="sd">              ctype = &quot;scale_relative_to_multiple_reservoirs&quot;</span>
<span class="sd">              ref_reservoirs = [r1, r2, k etc] # you must provide at least one</span>
<span class="sd">                                               # reservoir or constant</span>
<span class="sd">              scale = a overall scaling factor</span>
<span class="sd">           )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__misc_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Test that self.reservoir only contains numbers and reservoirs&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span> <span class="n">Number</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_reservoirs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">Number</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">*</span> <span class="n">r</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2"> must be reservoir or number, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__without_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">c</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span>

        <span class="c1"># scale = scale * (scale &gt;= 0)  # prevent negative fluxes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__with_isotopes__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        not sure that this correct WRT isotopes</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;Scale relative to multiple reservoirs is undefined for isotope calculations&quot;</span>
        <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process scales the flux as a function one or more reservoirs
constant which describes the
strength of relation between the reservoir concentration and
the flux scaling</p>

<p>F = C1 * C1 * k</p>

<p>where Mi denotes the concentration in one  or more reservoirs, k is one
or more constant(s). This process is typically called by the connector
instance when you specify the connection as</p>

<p>Connect(source =  upstream reservoir,
          sink = downstream reservoir,
          ctype = "scale_relative_to_multiple_reservoirs"
          ref_reservoirs = [r1, r2, k etc] # you must provide at least one
                                           # reservoir or constant
          scale = a overall scaling factor
       )</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#RateConstant">RateConstant</a></dt>
                                <dd id="ScaleRelative2otherReservoir.__init__" class="function"><a href="#RateConstant.__init__">RateConstant</a></dd>
                <dd id="ScaleRelative2otherReservoir.lkk" class="variable"><a href="#RateConstant.lkk">lkk</a></dd>
                <dd id="ScaleRelative2otherReservoir.flux" class="variable"><a href="#RateConstant.flux">flux</a></dd>
                <dd id="ScaleRelative2otherReservoir.k_value" class="variable"><a href="#RateConstant.k_value">k_value</a></dd>
                <dd id="ScaleRelative2otherReservoir.ref_value" class="variable"><a href="#RateConstant.ref_value">ref_value</a></dd>
                <dd id="ScaleRelative2otherReservoir.reservoir" class="variable"><a href="#RateConstant.reservoir">reservoir</a></dd>
                <dd id="ScaleRelative2otherReservoir.scale" class="variable"><a href="#RateConstant.scale">scale</a></dd>

            </div>
            <div><dt><a href="#Process">Process</a></dt>
                                <dd id="ScaleRelative2otherReservoir.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="ScaleRelative2otherReservoir.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="ScaleRelative2otherReservoir.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="ScaleRelative2otherReservoir.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="ScaleRelative2otherReservoir.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Flux_Balance">
                                <div class="attr class">
        <a class="headerlink" href="#Flux_Balance">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Flux_Balance</span>(<span class="base"><a href="#RateConstant">RateConstant</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Flux_Balance</span><span class="p">(</span><span class="n">RateConstant</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process calculates a flux between two reservoirs as a function</span>
<span class="sd">    of multiple reservoir concentrations and constants.</span>

<span class="sd">    Note that could result in negative fluxes. which might cause</span>
<span class="sd">    issues with isotope ratios (untested)</span>

<span class="sd">    This will work with equilibrium reactions between two reservoirs where the</span>
<span class="sd">    reaction can be described as</span>

<span class="sd">    K * [R1] = R[2] * [R3]</span>

<span class="sd">    you can have more than two terms on each side as long as they are</span>
<span class="sd">    constants or reservoirs</span>

<span class="sd">    Equilibrium(</span>
<span class="sd">                name = &quot;Name&quot;,</span>
<span class="sd">                reservoir = reservoir handle,</span>
<span class="sd">                left = [] # list with reservoir names or constants</span>
<span class="sd">                right = [] # list with reservoir names or constants</span>
<span class="sd">                flux = flux handle,</span>
<span class="sd">                k_value = a constant, defaults to 1</span>
<span class="sd">    )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># redefine misc_init which is being called by post-init</span>
    <span class="k">def</span> <span class="nf">__misc_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sort out input variables&quot;&quot;&quot;</span>

        <span class="n">Rl</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Reservoir</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Rr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Reservoir</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Cl</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Cr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># parse the left hand side</span>

        <span class="n">em</span> <span class="o">=</span> <span class="s2">&quot;left/right values must be constants or reservoirs&quot;</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Rl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cl</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_by_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="p">[</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span> <span class="n">em</span><span class="p">)</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Rr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="p">]</span> <span class="o">=</span> <span class="n">sort_by_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="p">[</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span> <span class="n">em</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this will be called by the Model.run() method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">kl</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">kr</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">NDArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

        <span class="c1"># calculate the product of reservoir concentrations for left side</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rl</span><span class="p">:</span>
            <span class="n">kl</span> <span class="o">*=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># multiply with any any constants on the right</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cl</span><span class="p">:</span>
            <span class="n">kl</span> <span class="o">*=</span> <span class="n">c</span>

        <span class="c1"># calculate the product of reservoir concentrations for right side</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rr</span><span class="p">:</span>
            <span class="n">kr</span> <span class="o">*=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1"># multiply with any any constants on the right</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="p">:</span>
            <span class="n">kr</span> <span class="o">*=</span> <span class="n">c</span>

        <span class="c1"># set flux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">kl</span> <span class="o">-</span> <span class="n">kr</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_value</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process calculates a flux between two reservoirs as a function
of multiple reservoir concentrations and constants.</p>

<p>Note that could result in negative fluxes. which might cause
issues with isotope ratios (untested)</p>

<p>This will work with equilibrium reactions between two reservoirs where the
reaction can be described as</p>

<p>K * [R1] = R[2] * [R3]</p>

<p>you can have more than two terms on each side as long as they are
constants or reservoirs</p>

<p>Equilibrium(
            name = "Name",
            reservoir = reservoir handle,
            left = [] # list with reservoir names or constants
            right = [] # list with reservoir names or constants
            flux = flux handle,
            k_value = a constant, defaults to 1
)</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#RateConstant">RateConstant</a></dt>
                                <dd id="Flux_Balance.__init__" class="function"><a href="#RateConstant.__init__">RateConstant</a></dd>
                <dd id="Flux_Balance.lkk" class="variable"><a href="#RateConstant.lkk">lkk</a></dd>
                <dd id="Flux_Balance.flux" class="variable"><a href="#RateConstant.flux">flux</a></dd>
                <dd id="Flux_Balance.k_value" class="variable"><a href="#RateConstant.k_value">k_value</a></dd>
                <dd id="Flux_Balance.ref_value" class="variable"><a href="#RateConstant.ref_value">ref_value</a></dd>
                <dd id="Flux_Balance.reservoir" class="variable"><a href="#RateConstant.reservoir">reservoir</a></dd>
                <dd id="Flux_Balance.scale" class="variable"><a href="#RateConstant.scale">scale</a></dd>

            </div>
            <div><dt><a href="#Process">Process</a></dt>
                                <dd id="Flux_Balance.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="Flux_Balance.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="Flux_Balance.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="Flux_Balance.r" class="variable"><a href="#Process.r">r</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="Flux_Balance.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Monod">
                                <div class="attr class">
        <a class="headerlink" href="#Monod">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Monod</span>(<span class="base"><a href="#Process">Process</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Monod</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This process scales the flux as a function of the upstream</span>
<span class="sd">    reservoir concentration using a Michaelis Menten type</span>
<span class="sd">    relationship</span>

<span class="sd">    F = F * a * F0 x C/(b+C)</span>

<span class="sd">    where F0 denotes the unscaled flux (i.e., at t=0), C denotes</span>
<span class="sd">    the concentration in the ustream reservoir, and a and b are</span>
<span class="sd">    constants.</span>

<span class="sd">    Example::</span>
<span class="sd">         Monod(name = &quot;Name&quot;,</span>
<span class="sd">               reservoir =  upstream_reservoir_handle,</span>
<span class="sd">               flux = flux handle ,</span>
<span class="sd">               ref_value = reference concentration</span>
<span class="sd">               a_value = constant,</span>
<span class="sd">               b_value = constant )</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>

        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># update the allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;a_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;b_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Q_</span><span class="p">),</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">SourceGroup</span><span class="p">,</span> <span class="n">SinkGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">ConnectionGroup</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;a_value&quot;</span><span class="p">,</span> <span class="s2">&quot;b_value&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_value&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;a_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;b_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="s2">&quot;Reservoir handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;a string value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="s2">&quot;a flux handle&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reservoir</span><span class="p">:</span> <span class="n">Reservoir</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this willbe called by Model.execute apply_processes</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a_value</span>
            <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_value</span> <span class="o">*</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_value</span> <span class="o">+</span> <span class="n">reservoir</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># prevent negative fluxes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">__plot__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ref_reservoirs</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Test the implementation&quot;&quot;&quot;</span>

        <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">ref_reservoirs</span> <span class="o">*</span> <span class="n">e</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">e</span><span class="p">))</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>  <span class="c1">#</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="c1"># Create a scatter plot for ax</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>This process scales the flux as a function of the upstream
reservoir concentration using a Michaelis Menten type
relationship</p>

<p>F = F * a * F0 x C/(b+C)</p>

<p>where F0 denotes the unscaled flux (i.e., at t=0), C denotes
the concentration in the ustream reservoir, and a and b are
constants.</p>

<p>Example::
     Monod(name = "Name",
           reservoir =  upstream_reservoir_handle,
           flux = flux handle ,
           ref_value = reference concentration
           a_value = constant,
           b_value = constant )</p>
</div>


                            <div id="Monod.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Monod.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Monod</span><span class="signature">(**kwargs: Dict[str, &lt;built-in function any&gt;])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ureg</span><span class="p">,</span> <span class="n">Q_</span>

        <span class="sd">&quot;&quot;&quot; Initialize this Process &quot;&quot;&quot;</span>
        <span class="c1"># get default names and update list for this Process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__defaultnames__</span><span class="p">()</span>  <span class="c1"># default kwargs names</span>

        <span class="c1"># update the allowed keywords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lkk</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;a_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;b_value&quot;</span><span class="p">:</span> <span class="n">Number</span><span class="p">,</span>
            <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Number</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Q_</span><span class="p">),</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">Reservoir</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Sink</span><span class="p">),</span>
            <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="n">Flux</span><span class="p">,</span>
            <span class="s2">&quot;register&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">SourceGroup</span><span class="p">,</span> <span class="n">SinkGroup</span><span class="p">,</span> <span class="n">ReservoirGroup</span><span class="p">,</span> <span class="n">ConnectionGroup</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lrk</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;reservoir&quot;</span><span class="p">,</span> <span class="s2">&quot;a_value&quot;</span><span class="p">,</span> <span class="s2">&quot;b_value&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_value&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># new required keywords</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initerrormessages__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bem</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;a_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;b_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;reservoir&quot;</span><span class="p">:</span> <span class="s2">&quot;Reservoir handle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ref_value&quot;</span><span class="p">:</span> <span class="s2">&quot;a number&quot;</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;a string value&quot;</span><span class="p">,</span>
                <span class="s2">&quot;flux&quot;</span><span class="p">:</span> <span class="s2">&quot;a flux handle&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__validateandregister__</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># initialize keyword values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__postinit__</span><span class="p">()</span>  <span class="c1"># do some housekeeping</span>
        <span class="c1"># legacy variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reservoir</span><span class="o">.</span><span class="n">mo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__register_name__</span><span class="p">()</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Monod.lkk" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Monod.lkk">#&nbsp;&nbsp</a>

        <span class="name">lkk</span><span class="annotation">: dict</span>
    </div>

    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Process">Process</a></dt>
                                <dd id="Monod.mo" class="variable"><a href="#Process.mo">mo</a></dd>
                <dd id="Monod.show_figure" class="function"><a href="#Process.show_figure">show_figure</a></dd>
                <dd id="Monod.direction" class="variable"><a href="#Process.direction">direction</a></dd>
                <dd id="Monod.flux" class="variable"><a href="#Process.flux">flux</a></dd>
                <dd id="Monod.r" class="variable"><a href="#Process.r">r</a></dd>
                <dd id="Monod.reservoir" class="variable"><a href="#Process.reservoir">reservoir</a></dd>

            </div>
            <div><dt><a href="esbmtk.html#esbmtkBase">esbmtk.esbmtk.esbmtkBase</a></dt>
                                <dd id="Monod.info" class="function"><a href="esbmtk.html#esbmtkBase.info">info</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
</body>
</html>